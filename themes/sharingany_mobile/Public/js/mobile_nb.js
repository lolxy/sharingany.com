!function(e){var t=false||document.getElementById("newBridge");!function(e){function t(e,t){return P(e,t)}function i(e,t,i){if(null==i&&(null==t?(i=e,e=null):(i=t,t=null,e instanceof Array&&(t=e,e=null))),null!=i){var n=window.opera;if(!e&&document.attachEvent&&(!n||"[object Opera]"!==n.toString())){var a=W();e=a&&a.getAttribute("data-require-id")}e?(o(e,t,i),J&&clearTimeout(J)):R[0]={deps:t,factory:i}}}function n(){var e=B.config[this.id];return e&&"object"==typeof e?e:{}}function o(e,t,i){C[e]||(C[e]={id:e,depsDec:t,deps:t||["require","exports","module"],factoryDeps:[],factory:i,exports:{},config:n,state:A,require:_(e),depMs:[],depMkv:{},depRs:[],depPMs:[]})}function a(e){var t=C[e];if(t&&!c(e,F)){var i=t.deps,n=t.factory,o=0;"function"==typeof n&&(o=Math.min(n.length,i.length),!t.depsDec&&n.toString().replace(/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,"").replace(/require\(\s*(['"'])([^'"]+)\1\s*\)/g,function(e,t,n){i.push(n)}));var a=[];S(i,function(i,n){var r,s,l=w(i),c=x(l.mod,e);c&&!D[c]?(l.res&&(s={id:i,mod:c,res:l.res},T[c]=1,t.depPMs.push(c),t.depRs.push(s)),r=t.depMkv[c],r||(r={id:l.mod,absId:c,hard:o>n},t.depMs.push(r),t.depMkv[c]=r,a.push(c))):r={absId:c},o>n&&t.factoryDeps.push(s||r)}),t.state=F,l(e),g(a)}}function r(){for(var e in T)s(e),h(e)}function s(e){function t(e){if(!c(e,F))return!1;if(c(e,M)||i[e])return!0;i[e]=1;var n=C[e],o=!0;return S(n.depMs,function(e){return o=t(e.absId)}),o&&S(n.depRs,function(e){return o=!(!e.absId||!c(e.absId,O))}),o&&(n.state=M),o}var i={};t(e)}function l(t){function i(){if(!n&&o.state===M){n=1;var i=1,a=[];if(S(o.factoryDeps,function(e){var t=e.absId;return D[t]||(h(t),c(t,O))?void a.push(t):(i=0,!1)}),i){try{var r=d(a,{require:o.require,exports:o.exports,module:o}),s=o.factory,l="function"==typeof s?s.apply(e,r):s;null!=l&&(o.exports=l),o.invokeFactory=null,delete T[t]}catch(u){if(n=0,/^\[MODULE_MISS\]"([^"]+)/.test(u.message)){var f=o.depMkv[RegExp.$1];return void(f&&(f.hard=1))}throw u}m(t)}}}var n,o=C[t];o.invokeFactory=i,S(o.depPMs,function(e){u(e,function(){S(o.depRs,function(i){i.absId||i.mod!==e||(i.absId=x(i.id,t),g([i.absId],r))})})})}function c(e,t){return C[e]&&C[e].state>=t}function h(e){var t=C[e];t&&t.invokeFactory&&t.invokeFactory()}function d(e,t){var i=[];return S(e,function(e,n){i[n]=t[e]||f(e)}),i}function u(e,t){if(c(e,O))return void t();var i=N[e];i||(i=N[e]=[]),i.push(t)}function m(e){var t=N[e]||[],i=C[e];i.state=O;for(var n=t.length;n--;)t[n]();t.length=0,delete N[e]}function f(e){return c(e,O)?C[e].exports:null}function p(e){S(R,function(t){o(e,t.deps,t.factory)}),R.length=0,a(e)}function g(t,i,n,o){function s(){if(!l){var n=1;S(t,function(e){return D[e]?void 0:n=!!c(e,O)}),n&&(l=1,"function"==typeof i&&i.apply(e,d(t,D)))}}if("string"==typeof t){if(h(t),!c(t,O))throw new Error('[MODULE_MISS]"'+t+'" is not exists!');return f(t)}o=o||{};var l=0;t instanceof Array&&(s(),l||(S(t,function(e){D[e]||c(e,O)||(u(e,s),o[e]||(e.indexOf("!")>0?U:V)(e,n),a(e))}),r()))}function V(e){function t(){var t=i.readyState;if("undefined"==typeof t||/^(loaded|complete)$/.test(t)){i.onload=i.onreadystatechange=null,i=null,p(e);for(var n in T)a(n);r()}}if(!z[e]&&!C[e]){z[e]=1;var i=document.createElement("script");i.setAttribute("charset","utf-8"),i.setAttribute("data-require-id",e),i.src=k(e+".js"),i.async=!0,i.readyState?i.onreadystatechange=t:i.onload=t,X(i)}}function U(e,t){function i(t){r.exports=t||!0,m(e)}function o(o){var r=t?C[t].require:P;o.load(a.res,r,i,n.call({id:e}))}if(!C[e]){var a=w(e),r={id:e,state:F};C[e]=r,i.fromText=function(e,t){T[e]=1,new Function(t)(),p(e)},o(f(a.mod))}}function y(e,t){var i=I(e,1,t);return i.sort(K),i}function b(){B.baseUrl=B.baseUrl.replace(/\/$/,"")+"/",H=y(B.paths),Y=y(B.map,1),S(Y,function(e){e.v=y(e.v)}),G=[],S(B.packages,function(e){var t=e;"string"==typeof e&&(t={name:e.split("/")[0],location:e,main:"main"}),t.location=t.location||t.name,t.main=(t.main||"main").replace(/\.js$/i,""),t.reg=E(t.name),G.push(t)}),G.sort(K),q=y(B.urlArgs,1),j=y(B.noRequests),S(j,function(e){var t=e.v,i={};e.v=i,t instanceof Array||(t=[t]),S(t,function(e){i[e]=1})})}function v(e,t,i){S(t,function(t){return t.reg.test(e)?(i(t.v,t.k,t),!1):void 0})}function k(e){var t=/(\.[a-z0-9]+)$/i,i=/(\?[^#]*)$/,n="",o=e,a="";i.test(e)&&(a=RegExp.$1,e=e.replace(i,"")),t.test(e)&&(n=RegExp.$1,o=e.replace(t,""));var r,s=o;return v(o,H,function(e,t){s=s.replace(t,e),r=1}),r||v(o,G,function(e,t,i){s=s.replace(i.name,i.location)}),/^([a-z]{2,10}:\/)?\//i.test(s)||(s=B.baseUrl+s),s+=n+a,v(o,q,function(e){s+=(s.indexOf("?")>0?"&":"?")+e}),s}function _(e){function t(t,n){if("string"==typeof t)return i[t]||(i[t]=g(x(t,e))),i[t];if(t instanceof Array){var o=[],a=[],r=[];S(t,function(t,i){var n=w(t),s=x(n.mod,e);a.push(s),T[s]=1,n.res?(o.push(s),r[i]=null):r[i]=s});var s={};S(a,function(e){var t;v(e,j,function(e){t=e}),t&&(t["*"]?s[e]=1:S(a,function(i){return t[i]?(s[e]=1,!1):void 0}))}),g(a,function(){S(r,function(i,n){null==i&&(r[n]=x(t[n],e))}),g(r,n,e)},e,s)}}var i={};return t.toUrl=function(t){return k(x(t,e))},t}function x(e,t){if(!e)return"";t=t||"";var i=w(e);if(!i)return e;var n=i.res,o=L(i.mod,t);if(S(G,function(e){var t=e.name;return t===o?(o=t+"/"+e.main,!1):void 0}),v(t,Y,function(e){v(o,e,function(e,t){o=o.replace(t,e)})}),n){var a=f(o);n=a.normalize?a.normalize(n,function(e){return x(e,t)}):x(n,t),o+="!"+n}return o}function L(e,t){if(0===e.indexOf(".")){var i=t.split("/"),n=e.split("/"),o=i.length-1,a=n.length,r=0,s=0;e:for(var l=0;a>l;l++){var c=n[l];switch(c){case"..":if(!(o>r))break e;r++,s++;break;case".":s++;break;default:break e}}return i.length=o-r,n=n.slice(s),i.concat(n).join("/")}return e}function w(e){var t=e.split("!");return t[0]?{mod:t[0],res:t[1]}:null}function I(e,t,i){var n=[];for(var o in e)if(e.hasOwnProperty(o)){var a={k:o,v:e[o]};n.push(a),t&&(a.reg="*"===o&&i?/^/:E(o))}return n}function W(){if(Q)return Q;if(Z&&"interactive"===Z.readyState)return Z;for(var e=document.getElementsByTagName("script"),t=e.length;t--;){var i=e[t];if("interactive"===i.readyState)return Z=i,i}}function X(e){Q=e,ee?$.insertBefore(e,ee):$.appendChild(e),Q=null}function E(e){return new RegExp("^"+e+"(/|$)")}function S(e,t){if(e instanceof Array)for(var i=0,n=e.length;n>i&&t(e[i],i)!==!1;i++);}function K(e,t){var i=e.k||e.name,n=t.k||t.name;return"*"===n?-1:"*"===i?1:n.length-i.length}var C={},T={},A=1,F=2,M=3,O=4,P=_();t.version="1.8.6",t.loader="esl",t.toUrl=P.toUrl;var J;i.amd={};var N={},D={require:t,exports:1,module:1},R=[],z={},B={baseUrl:"./",paths:{},config:{},map:{},packages:[],noRequests:{},urlArgs:{}};t.config=function(e){function t(e){o.push(e)}if(e){for(var i in B){var n=e[i],o=B[i];if(n)if("urlArgs"===i&&"string"==typeof n)B.urlArgs["*"]=n;else if(o instanceof Array)S(n,t);else if("object"==typeof o)for(var i in n)o[i]=n[i];else B[i]=n}b()}},b();var H,G,Y,q,j,Q,Z,$=document.getElementsByTagName("head")[0],ee=document.getElementsByTagName("base")[0];ee&&($=ee.parentNode),e.define||(e.define=i,e.require||(e.require=t),e.esl=t)}(t);var require=t.require,define=t.define;require.config({ 'baseUrl': '//sgoutong.baidu.com/embed/1487658916/asset', 'paths': { 'cl': 'common/css' }, 'packages': [ { 'name': 'bull', 'location': '../dep/bull/asset', 'main': 'main' }, { 'name': 'im-lib', 'location': '../dep/im-lib/0.1.0/asset/pc', 'main': 'main' }, { 'name': 'im-core', 'location': '../dep/im-core/0.2.0/asset', 'main': 'main' } ] }),define("bull/aop/JointPoint",["require"],function(require){function e(e,t,i,n,o,a){this.thisp=e,this.args=t,this.modName=i,this.funcName=n,this.func=o,this.returnValue=a}return e.prototype={constructor:e,getThis:function(){return this.thisp},getArgs:function(){return this.args},getModName:function(){return this.modName},getFuncName:function(){return this.funcName},getFunc:function(){return this.func},setReturnValue:function(e){this.returnValue=e},getReturnValue:function(){return this.returnValue}},e}),define("bull/aop/aopEmitter",["require","./main"],function(require){function e(e,i,n){var o=[],a=t;if(a=a[e]||{},a=a[i]||{},a=a[n]||[],"[object Array]"==={}.toString.call(a))for(var r=0;r<a.length;r++)o.push(a[r]);return o}var exports={},t={};return exports.on=function(e,i,n,o){var a=t;a[e]=a[e]||{},a=a[e],a[i]=a[i]||{},a=a[i],a[n]=a[n]||[],a=a[n],a.push({func:o.func,funcName:o.funcName,modName:o.modName})},exports.getBefore=function(t,i){var n=require("./main"),o=n.TypeEnum.BEFORE;return e(o,t,i)},exports.queryBefore=function(e,t){var i=exports.getBefore();if(console.log("method before "+e+" -> "+t+":"),!i.length)return void console.log("none");for(var n=0;n<i.length;n++)console.log(i[n].modName+" -> "+i[n].funcName);console.log("-----------------------------------")},exports.getAfter=function(t,i){var n=require("./main"),o=n.TypeEnum.AFTER;return e(o,t,i)},exports.queryAfter=function(e,t){var i=exports.getAfter();if(!i.length)return void console.log("none");console.log("method after "+e+" -> "+t+":");for(var n=0;n<i.length;n++)console.log(i[n].modName+" -> "+i[n].funcName);console.log("-----------------------------------")},exports.getRegisterAop=function(e){var i={},n=[],o=t[e];for(var a in o)if(o.hasOwnProperty(a)){var r=o[a];for(var s in r)if(r.hasOwnProperty(s)){if(!i[s])i[s]=!0,n.push({modName:a,funcName:s,from:r[s][0].modName})}}return n},exports.emit=function(t,i,n,o){for(var a=e(t,i,n),r=0;r<a.length;r++)a[r].func(o)},exports}),define("bull/microPromise/microPromise",["require"],function(require){function e(){for(var e=arguments.length,i=0,n=t(),o=[],a=0;e>a;a++){var r=arguments[a];!function(t){r.then(function(a){if(i++,o[t]=a,i===e)n.resolve.apply(n,o)},function(){n.reject()})}(a)}return n.promise()}var t=function(){function e(){for(var e=this,t=0;t<o.length;t++)!function(t){if(r&&r[0]&&r[0].then)r[0].then(function(){o[t].apply(e,arguments)});else setTimeout(function(){o[t].apply(e,r)},0)}(t)}function i(){for(var e=this,t=0;t<a.length;t++)!function(t){setTimeout(function(){a[t].apply(e,r)},0)}(t)}function n(e,i){var n=t();if(h===l.resolved){var c=this;setTimeout(function(){e.apply(c,r)},0)}else if(h===l.reject){var c=this;setTimeout(function(){i.call(c,s)},0)}else{if(e)o.push(function(){n.resolve(e.apply(c,arguments))});if(i)a.push(function(e){i(e),n.reject()})}return n.promise()}if(!this instanceof t)return new t;var o=[],a=[],r=[],s="",l={pendding:1,resolved:2,rejected:3},h=l.pendding,c={resolve:function(){var t=Array.prototype.slice.call(arguments,0);if(h===l.pendding)r=t,h=l.resolved,e.call(this)},reject:function(e){if(h===l.pendding)s=e,h=l.rejected,i.call(this)},then:n,promise:function(){return{then:n}}};return c};return{Deferred:t,when:e}}),define("bull/aop/main",["require","./JointPoint","./aopEmitter","../loader","../microPromise/microPromise"],function(require){function e(e,t,i){a.emit(r.BEFORE,e,t,i)}function t(e,t,i){a.emit(r.AFTER,e,t,i)}function i(e){return e=e||"",e.replace(/^\s|\s$/g,"")}function n(e){e=e||"";var t=e.split(","),n=i(t[0]||""),o=i(t[1]),a=i(t[2]);t=n.split(".");var r=t[0],s=t[1],l=t[2];return{packageName:r,modName:s,funcName:l,before:o,after:a}}var exports={},o=require("./JointPoint"),a=require("./aopEmitter"),r=exports.TypeEnum={BEFORE:"type1",AFTER:"type2"};return exports.createAopProxy=function(i,n,a){var r=require("../loader"),s=require("../microPromise/microPromise");return function(){var l=[],h=Array.prototype.slice.call(arguments,0),c=new o(this,h,i,n,a),m={jointPoint:c,microPromise:s};e(i,n,c);var d=r.getInjection(i)||{},u=d[n]||[];if("[object Array]"==={}.toString.call(u))for(var p=0;p<u.length;p++){var f=u[p];if(f in m)l.push(m[f]);else l.push(r.get(f))}l=l.concat(h);var V=a.apply(this,l);if(V&&V.then)V.then(function(e){c.setReturnValue(e),t(i,n,c)});else c.setReturnValue(V),t(i,n,c);return V}},exports.aspectRegister=function(e,t,i){var o=require("../loader");if(-1===e.indexOf("."))e=t+"."+e;for(var s=0;s<i.length;s++)!function(t){t.before&&a.on(r.BEFORE,t.packageName+"."+t.modName,t.funcName,{modName:e,funcName:t.before,func:function(i){var n=o.get(e)[t.before];if(!n)throw'module "'+e+"\" don't have method "+t.before;n.apply(i.getThis(),i.getArgs())}}),t.after&&a.on(r.AFTER,t.packageName+"."+t.modName,t.funcName,{modName:e,funcName:t.after,func:function(i){var n=o.get(e)[t.after];if(!n)throw'module "'+e+"\" don't have method "+t.after;n.apply(i.getThis(),i.getArgs())}})}(n(i[s]))},exports}),define("bull/loader",["require","./aop/main"],function(require){function e(t,i){var n;if("function"==typeof i){e(t,i.prototype);var o=l(t,a,i);return o.prototype=i.prototype,o}else{for(var a in i)if(i.hasOwnProperty(a)){if(n=i[a],"function"==typeof n)i[a]=l(t,a,n)}else;return i}}function t(e){e=e||[];for(var t=0;t<e.length;t++)exports.init(e[t])}function i(t,i){for(var n in t)if(t.hasOwnProperty(n)){var o=t[n];if(n=i+"."+n,a.hasOwnProperty(n)){if(o._belong&&n!==o._belong)throw'module conflict: module "'+n+'" is already register to "'+o._belong+'"'}else{if(o._belong)throw'module "'+n+'" already register to "'+o._belong+'"';o._belong=n,a[n]=e(n,o)}}else;}function n(e,t){e=e||[];for(var i=0;i<e.length;i++){var n=e[i];r[n.id]=r[n.id]||{};var o=r[n.id],a=n.method;for(var s in a)o[s]=a[s]}}function o(e,t){for(var i=0;i<e.length;i++){var n=e[i];h(n.id,t,n.pointCut)}}var exports={},a={},r={},s=require("./aop/main"),l=s.createAopProxy,h=s.aspectRegister;return exports.init=function(e){if(!e._initialized){e._initialized=!0;var a=e["package"];if(!a&&(e.resource||e.aspect))throw"package name not found";t(e.importConfig),e.resource&&i(e.resource,a),e.aspect&&o(e.aspect,a),e.injection&&n(e.injection,a)}},exports.getInjection=function(e){return r[e]},exports.getDeps=function(e){var t=r[e],i={};for(var n in t)if(t.hasOwnProperty(n))for(var o=t[n],a=0;a<o.length;a++)i[o[a]]=!0;delete i[e];var s=[];for(var n in i)if(n.indexOf(".")>-1)s.push(n);return s},exports.queryDep=function(e){var t=exports.getDeps(e);if(console.log("deps of "+e+" is:"),!t.length)console.log("none");for(var i=0;i<t.length;i++)console.log(t[i]);console.log("-----------------------------------")},exports.getModules=function(e){e=e||"";var t=[];for(var i in a)if(a.hasOwnProperty(i))if(e){if(i.indexOf(e)>-1)t.push(i)}else t.push(i);return t},exports.queryModule=function(e){var t=exports.getModules(e);if(e)console.log('modules contains "'+e+'":');else console.log("all modules:");for(var i=0;i<t.length;i++)console.log(t[i]);console.log("-----------------------------------")},exports.queryInvoke=function(e){var t=[],i={};for(var n in r)if(r.hasOwnProperty(n)){var o=r[n];for(var a in o)if(o.hasOwnProperty(a))for(var s=o[a],l=0;l<s.length;l++){var h=s[l];if(h===e){var c=n+h;if(c in i)continue;else i[c]=!0;t.push({modName:n,funcName:a})}}}if(t.length){console.log("module "+e+" used by these method:");for(var l=0;l<t.length;l++)console.log(t[l].modName+" -> "+a)}else console.log("module"+e+" used nowhere");console.log("-----------------------------------")},exports.checkDep=function(){var e,t=0;console.log("checking deps:");for(var i in a)if(a.hasOwnProperty(i)){e=exports.getDeps(i);for(var n=0;n<e.length;n++)if(!exports.has(e[n]))if(e[n].indexOf(".")>-1)t++,console.log(e[n]+" is required by "+i+" but now missing")}if(!t)console.log("all dependencies is ready");console.log("-----------------------------------")},exports.has=function(e){return e in a},exports.get=function(e){if(e in a)return a[e];else throw'module "'+e+'" not found'},exports}),define("bull/main",["require","./loader","./aop/aopEmitter"],function(require){function e(){var e=document.createElement("div"),t=e.style;t.position="fixed",t.right="20px",t.top="20px",t.border="solid 1px black",t.backgroundColor="#eee",e.innerHTML="\u70b9\u6b64\u67e5\u770b<br/>\u6a21\u5757\u5173\u7cfb";var i=!1;e.onclick=function(){if(!i)i=!0,require(["bull/debug"],function(e){i=!1,e.entry()})},document.body.insertBefore(e,document.body.firstChild)}function t(){var t=location.hash;if(t.indexOf("bullDebug")>-1)e()}var exports={},i=require("./loader"),n=require("./aop/aopEmitter");return exports.get=i.get,exports.queryBefore=n.queryBefore,exports.queryAfter=n.queryAfter,exports.queryInvoke=i.queryInvoke,exports.queryDep=i.queryDep,exports.checkDep=i.checkDep,exports.queryModule=i.queryModule,exports.init=function(e){t(),i.init(e)},exports}),define("bull",["bull/main"],function(e){return e}),define("im-lib/lang/isObject",[],function(){return function(e){return"[object Object]"==Object.prototype.toString.call(e)}}),define("im-lib/lang/isArray",[],function(){return function(e){return"[object Array]"==Object.prototype.toString.call(e)}}),define("im-lib/lang/extend",[],function(){return function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i];return e}}),define("im-lib/lang/each",["require","./isArray"],function(require){return function(e,t,i){if(require("./isArray")(e)){for(var n=e.length,o=0;n>o;o++)if("function"==typeof t)t.call(i,e[o],o,e)}else for(var a in e)if(e.hasOwnProperty(a))t.call(i,a,e[a],e)}}),define("im-lib/lang",["require","./lang/isObject","./lang/isArray","./lang/extend","./lang/each"],function(require){var exports={};return exports.isObject=require("./lang/isObject"),exports.isArray=require("./lang/isArray"),exports.extend=require("./lang/extend"),exports.each=require("./lang/each"),exports}),define("im-lib/json",[],function(){function e(e){if(/["\\\x00-\x1f]/.test(e))e=e.replace(/["\\\x00-\x1f]/g,function(e){var t=a[e];if(t)return t;else return t=e.charCodeAt(),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16)});return'"'+e+'"'}function t(e){var t,i,n,a=["["],r=e.length;for(i=0;r>i;i++)switch(n=e[i],typeof n){case"undefined":case"function":case"unknown":break;default:if(t)a.push(",");a.push(o(n)),t=1}return a.push("]"),a.join("")}function i(e){return 10>e?"0"+e:e}function n(e){return'"'+e.getFullYear()+"-"+i(e.getMonth()+1)+"-"+i(e.getDate())+"T"+i(e.getHours())+":"+i(e.getMinutes())+":"+i(e.getSeconds())+'"'}function o(i){switch(typeof i){case"undefined":return"undefined";case"number":return isFinite(i)?String(i):"null";case"string":return e(i);case"boolean":return String(i);default:if(null===i)return"null";else if(i instanceof Array)return t(i);else if(i instanceof Date)return n(i);else{var a,r,s=["{"],l=o;for(var h in i)if(Object.prototype.hasOwnProperty.call(i,h))switch(r=i[h],typeof r){case"undefined":case"unknown":case"function":break;default:if(a)s.push(",");a=1,s.push(l(h)+":"+l(r))}return s.push("}"),s.join("")}}}var exports={};exports.parse=function(e){if(window.JSON&&JSON.parse)return JSON.parse(e);else return new Function("return ("+e+")")()},exports.stringify=function(e){if(window.JSON&&JSON.stringify)return JSON.stringify(e);else return o(e)};var a={"\b":"\\b"," ":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return exports}),define("im-lib/net",[],function(){function e(){if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(window.XMLHttpRequest)return new XMLHttpRequest;else return void 0}var exports={};return exports.imgRequest=function(e){var t=document.createElement("img");t.src=e},exports.jsonp=function(e,t){function i(){return(new Date).getTime()}function n(){return Math.random().toString().substr(2)}function o(e){if(e){var t=e.parentNode;if(t&&11!==t.nodeType)t.removeChild(e)}}function a(e){var t="";if("string"==typeof e)t=e;else if("object"==typeof e)for(var n in e)if(e.hasOwnProperty(n))t+="&"+n+"="+encodeURIComponent(e[n]);return t+="&_time="+i(),t=t.substr(1)}function r(e,r,s,l){var h,c=(r.op,r.l);r=null,e=e+(-1===e.indexOf("?")?"?":"&")+a(r);var m=/callback=(\w+)/.exec(e);if(m&&m[1])h=m[1];else h="jsonp_bridge_"+i()+"_"+n(),e=e.replace("?","?"+t.key+"="+h+"&");var d=document.createElement("script");d.type="text/javascript",d.src=e,d.id="id_"+h,d.charset="utf-8";var u=!0,p=null;if(window[h]=function(e){clearTimeout(p),window[h]=void 0;var t=document.getElementById("id_"+h);setTimeout(function(){o(t)},0),s(e),u=!1},"onerror"in d)d.onerror=function(){l&&l(),o(d)},u=!1;var f=1e4;if(1===c)f+=2e4;p=setTimeout(function(){if(u)l&&l(),o(d)},f);var V=document.getElementsByTagName("head")[0];if(V)setTimeout(function(){V.appendChild(d)},0)}r(e,t,t.success,t.failure)},exports.request=function(t,i){var n=e();return n.open(i.method||"GET",t),n.onreadystatechange=function(){if(4===n.readyState)if(n.status>=200&&n.status<300||304===n.status){if(i.success)i.success(n.responseText)}else if(i.failure)i.failure()},n.send(i.data),n},exports.upload=function(e,t,i,n,o){function a(){n(),m.onload=function(){},m.parentNode.removeChild(m)}function r(){o(),m.onerror=function(){},m.parentNode.removeChild(m)}if("/"===e.charAt(0)&&!/^\/\//.test(e))e=location.protocol+"//"+location.host+e;if("[object String]"===Object.prototype.toString.call(t)){var s=t;clouda.device.fs.post(s,e,{onsuccess:function(e){if(n)n(e)},onfail:function(){if(o)o()},uploadKey:i,param:{}})}else if(t.nodeName){var l="upload_iframe"+parseInt(1e4*Math.random(),10),h='<iframe id="'+l+'" name="'+l+'" width="0" height="0" border="0" style="width: 0; height: 0; border: none;">',c=document.createElement("div");c.innerHTML=h;var m=c.getElementsByTagName("iframe")[0];if(document.body.appendChild(m),t.setAttribute("target",l),t.setAttribute("action",e),t.setAttribute("method","post"),t.setAttribute("enctype","multipart/form-data"),t.setAttribute("encoding","multipart/form-data"),m.attachEvent)m.attachEvent("onload",a),m.attachEvent("onerror",r);else m.onload=a,m.onerror=r;t.submit()}else if(window.FormData){var d=new FormData;d.append(i,t),exports.request(e,{success:n,failure:o,data:d,method:"post"})}},exports}),define("im-lib/util",[],function(){var exports={},e="0123456789ABCDEF";return exports.uuid=function(){for(var t=[],i=0;32>i;i++)t[i]=e.substr(Math.floor(16*Math.random()),1);t[12]="4",t[16]=e.substr(3&t[16]|8,1);var n=t.join("").toLowerCase();return n=n.toLowerCase(),n=n.replace(/^(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})$/,"$1-$2-$3-$4-$5")},exports.decodeHTML=function(e){return e=e||"",e.replace("&lt;","<").replace("&gt;",">").replace("&amp;","&").replace("&quot;",'"').replace("&nbsp;"," ")},exports.encodeHTML=function(e){return e=e||"",e.replace(/</g,"&lt").replace(/>/g,"&gt").replace(/&/g,"&amp").replace(/"/g,"&quot").replace(/ /g,"&nbsp")},exports.getText=function(e){var t="";if(3===e.nodeType||4===e.nodeType)t+=exports.decodeHTML(e.nodeValue);else if("IMG"===e.tagName)if(e.getAttribute("data-face-id"))return"["+e.getAttribute("data-face-text")+"]";else return"[\u56fe\u7247]";else if(8!==e.nodeType)for(var i=0;i<e.childNodes.length;i++)t+=exports.getText(e.childNodes[i]);return t},exports}),define("im-lib/Emitter",[],function(){function e(){}var t=e.prototype;return t._getEvents=function(){if(!this._events)this._events={};return this._events},t._getMaxListeners=function(){if(isNaN(this.maxListeners))this.maxListeners=10;return this.maxListeners},t.on=function(e,t){var i=this._getEvents(),n=this._getMaxListeners();i[e]=i[e]||[];var o=i[e].length;if(o>=n&&0!==n)throw new RangeError("Warning: possible Emitter memory leak detected. "+o+" listeners added.");return i[e].push(t),this},t.once=function(e,t){function i(){n.off(e,i),t.apply(this,arguments)}var n=this;return i.listener=t,this.on(e,i),this},t.off=function(e,t){var i=this._getEvents();if(0===arguments.length)return this._events={},this;var n=i[e];if(!n)return this;if(1===arguments.length)return delete i[e],this;for(var o,a=0;a<n.length;a++)if(o=n[a],o===t||o.listener===t){n.splice(a,1);break}return this},t.emit=function(e){var t=this._getEvents(),i=t[e],n=Array.prototype.slice.call(arguments,1);if(i){i=i.slice(0);for(var o=0,a=i.length;a>o;o++)i[o].apply(this,n)}return this},t.listeners=function(e){var t=this._getEvents();return t[e]||[]},t.setMaxListeners=function(e){return this.maxListeners=e,this},e.mixin=function(t){for(var i in e.prototype)t[i]=e.prototype[i];return t},e}),define("im-lib/userData",[],function(){function e(e){return e.replace(o,"___")}function t(){}function i(){if(!n)try{return n=document.createElement("input"),n.type="hidden",n.addBehavior("#default#userData"),document.body.appendChild(n),!0}catch(e){return n={load:t,save:t,getAttribute:t,setAttribute:t,removeAttribute:t},!1}return!0}var exports={},n=null,o=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g"),a=365,r=location.hostname+"_bridge_im";return exports.setItem=function(t,o){if(i()){t=e(t);var s=new Date;s.setDate(s.getDate()+a),n.expires=s.toUTCString(),n.load(r),n.setAttribute(t,o),n.save(r)}},exports.getItem=function(t){if(!i())return"";else return t=e(t),n.load(r),n.getAttribute(t)},exports.removeItem=function(){if(i())key=e(key),n.load(r),n.removeAttribute(key),n.save(r)},exports.clear=function(){var e=new Date;e.setDate(e.getDate()-1),n.expires=e.toUTCString()},exports}),define("im-lib/localStorage",["require","关于我们.htmlerData"],function(require){var e,exports={};try{e=window.localStorage||require("关于我们.htmlerData")}catch(t){e=require("关于我们.htmlerData")}return exports.setItem=function(t,i){try{e.setItem(t,i)}catch(n){}},exports.getItem=function(t){return e.getItem(t)},exports.removeItem=function(t){e.removeItem(t)},exports.clear=function(){e.clear()},exports}),define("im-lib/main",["require","./lang","./json","./net","./util","./Emitter","./localStorage"],function(require){return{lang:require("./lang"),json:require("./json"),net:require("./net"),util:require("./util"),Emitter:require("./Emitter"),localStorage:require("./localStorage")}}),define("im-lib",["im-lib/main"],function(e){return e}),define("im-core/main",["require","im-lib","im-lib/Emitter","bull","./bullConfig"],function(require){function e(module,e,t){module.on(e,function(){var i=Array.prototype.slice.call(arguments);i.unshift(t||e),exports.emit.apply(exports,i)})}var t=require("im-lib"),i=require("im-lib/Emitter"),exports={};return i.mixin(exports),exports.messageHandler=function(e,i){var n=i.adata&&t.json.parse(i.adata)||{},o=n.nickname||e.sinfo.nickname||i.from,a=1e3*i.time;exports.decode(i,function(e){exports.emit("message",e,o,a,i.msgHandlerType||"")})},exports.decode=function(e,t){},exports.init=function(e){var t=require("bull"),i=require("./bullConfig");t.init(i),exports.initCore(e)},exports.initCore=function(t,i,n,o,a){n.extend(exports,o),exports.addPlugin(),n.extend(i,a||{}),i.anonym=i.bid?0:1,t.on("message",exports.messageHandler);var r=["error","reconnect","connected","disconnect","offline","csoffline","invitefail","queueing","otherwebimalive","fetchhistorysuccess","fetchhistoryfail","fetchhistoryfinish","visitorblock","autoendtalk","currentIR","showMsgRemind","csonline","transferError","fininshIR","updateNewCSR","visitorTransfer","unknownMsg"];n.each(r,function(i){e(t,i)})},exports.addPlugin=function(){for(var e=0;e<arguments.length;e++)exports.plugin(arguments[e])},exports.connect=function(e,t,i,n,o){function a(t){if(t.invited)t.status=3;switch(t.status){case 0:case 1:e.connect(n,o);break;case 2:e.connect(n,o);break;case 3:if(o.invited||t.invited)t.invited=1,t.from=o.from,e.connect(n,t);else t.reason="talk to other",e.disconnect(t),e.setStopPick(!1),e.pick();break;case 4:e.connect(n,o);break;default:e.connect(n,o)}}if(exports.emit("startconnect"),i.isLogin())a(t);else i.login(a,function(){exports.emit("error",{type:"init"})},function(){exports.emit("visitorblock")})},exports.auth=function(e,t,i){if(e.isLogin());else e.login(function(){exports.emit("connected")},function(){exports.emit("error",{type:"init"})})},exports.send=function(e,t,i,n){function o(){exports.emit("sendfinish",i),exports.emit("sendsuccess",i)}function a(){exports.emit("sendfail",i)}if(exports.emit("trysendmsg"),!e.isConnected())return exports.emit("sendfail",i),!1;else return t.encode(i,function(t){t.adata=n,e.send(t,o,a)},a),!0},exports.preSend=function(e,t,i){if(!e.isConnected())return!1;else return void e.preSend({mtype:0,content:i.text})},exports.disconnect=function(e,t,i,n){if(exports.emit("sessioncut"),n!==!1)e.disconnect();if(i!==!1)t.logout()},exports.plugin=function(e,t){if(t.encoder)e.addEncoder(t.encoder);if(t.decoder)e.addDecoder(t.decoder);if(t.emit)t.emit=function(){var e=Array.prototype.slice.call(arguments);exports.emit.apply(exports,e)}},exports.get=function(e,t){return e.get(t)},exports.isConnected=function(e){return e.isConnected()},exports.sendOfflineMsg=function(e,t,i,n){function o(){exports.emit("sendofflinemsgfinish",i),exports.emit("sendofflinemsgsuccess",i)}function a(){exports.emit("sendofflinemsgfail",i)}if(e.isConnected())return exports.emit("sendofflinemsgfail",i),!1;else return t.encode(i,function(t){t.adata=n,e.send(t,o,a)},a),!0},exports.fetchHistory=function(e,t){e.fetchHistory(t)},exports}),define("im-core",["im-core/main"],function(e){return e}),define("im-core/plugin/fileTransfer",["require","../main"],function(require){var e=1,exports={};exports.encoder={};var t=exports.encoder;t.fileAccept=function(t,i){i({mtype:e,content:{type:"file",data:{bcsName:t.bcsName,name:t.name,size:t.size,type:"accept"}}})},t.fileVUpload=function(t,i){i({mtype:e,content:{type:"file",msgInfo:t.msgInfo,data:{status:t.status,bcsName:t.bcsName,name:t.name,size:t.size,type:"vUpload"}}})},t.fileVDownLoad=function(t,i){i({mtype:e,content:{type:"file",data:{status:t.status,bcsName:t.bcsName,name:t.name,type:"vDownLoad"}}})},t.fileVCancelSend=function(t,i){i({mtype:e,content:{type:"file",data:{bcsName:t.bcsName,name:t.name,type:"vCancelSend"}}})},exports.decoder={};var i=require("../main");return exports.decoder.fileTransfer=function(e,t){e=e||{};var n=e.content||{},o=n.data||{},a=n.msgInfo||{},r={bcsName:o.bcsName,name:o.name},s="";switch(o.type){case"accept":s="fileAccept",r.status=o.status;break;case"sDownLoad":s="fileSDownLoad",r.status=o.status;break;case"sUpLoad":s="fileSUpload",r.size=o.size;break;case"vCancelSend":s="vCancelSend";break;case"vDownLoad":s="vDownLoad",r.status=o.status;break;case"vUpload":s="vUpload"}i.emit(s,r,a,e.msgHandlerType||"")},exports}),define("im-core/const",[],function(){var exports={};return exports.PLATFORM_PC=0,exports.PLATFORM_MOBILE=1,exports.SERVER_TIEXIN=1,exports.SERVER_DUZHAN=2,exports.SERVER_QIAO=3,exports.AUTH_TYPE_LOCAL=0,exports.AUTH_TYPE_QIAO=4,exports.AUTH_TYPE_DUZHAN=5,exports.CHAT_TYPE_USER=0,exports.CHAT_TYPE_GROUP=1,exports.CHAT_TYPE_IR=4,exports.PUSH_TYPE_BYE=2,exports.PUSH_TYPE_CHAT=3,exports.PUSH_TYPE_OFFLINE=4,exports.PUSH_TYPE_FETCH_HISTORY=5,exports.PUSH_TYPE_PRE_SEND=6,exports.PUSH_TYPE_FETCH_SESSION_MESSAGE=7,exports.PUSH_TYPE_MSG_SYNC=9,exports.CHART_START_TYPE="vsturl:u",exports}),define("im-core/config",["require","./const"],function(require){var e=require("./const");return{bid:"",siteid:"",eid:"",crossDomain:!1,platform:e.PLATFORM_PC,server:e.SERVER_QIAO,authType:e.AUTH_TYPE_QIAO,authToken:"bridge",urlRoot:"/",sid:"-100",tid:"-1",fromType:1,ttype:1,reasons:["vstreq:u","vstsys:u","vstwtr:u","vsturl:u","vstwtr:f","vstreq:f","vstsys:f"],isPageOnload:!0,isSessionConnected:!1}}),define("im-core/plugin/unknownMsg",["require","im-lib","../config","im-core"],function(require){function e(e,t){t({content:{content:{data:e.content,msgInfo:e.msgInfo||{},type:e.msgType||""},type:r},mtype:a})}function t(e,t){e=e||{};var r=e.content||{},s=r.content;if(r.mtype===o||r.mtype===a)try{s=i.json.parse(r.content),s.msgInfo=s.msgInfo||{};var h=e.adata&&i.json.parse(e.adata)||{};s.nickname=h.nickname||l}catch(c){s=r.content}s.role=e.from===n.bid?0:1,require("im-core").emit("unknownMsg",s)}var exports={},i=require("im-lib"),n=require("../config"),o=1,a=4,r="unable message",s="unable message",l="\u5bf9\u65b9";return exports.encoder={},exports.encoder[r]=e,exports.decoder={},exports.decoder[s]=t,exports}),define("im-core/net",["require","im-lib"],function(require){function e(){}var exports={},t=require("im-lib").Emitter;t.mixin(exports);var i="POST";return exports.jsonToQuery=function(e,t,i){var n=[];return t.each(i,function(i,o){if(t.isObject(o))o=e.stringify(o);if("number"!=typeof o)o=encodeURIComponent(o);n.push(i+"="+o)}),n.join("&")},exports.request=function(t,n,o,a,r,s,l){var h=t.urlRoot+r;s=s||{};var c=s.failure||e,m=s.success||e;s.success=function(e){try{if(-1!==Object.prototype.toString.call(e).indexOf("String"))e=a.parse(e)}catch(t){return void c()}if(n.set("sn",e.n_sn),!e.status||2===e.status)exports.emit("response",r,e.body||e),m(e.body||e);else exports.emit("auth invalid"),c(e)};var d=s.data||{};if(exports.emit("request",r,d),d.v=t.bid,d.s=t.siteid,d.e=t.eid,d.dev=t.platform,d.auth=n.get(),s.data=null,t.crossDomain){if(h+=h.indexOf("?")>=0?"&":"?",h+=exports.jsonToQuery(d),s.type=d.type,s.key="cb",s.op=d.op,s.l=d.l,2===d.type&&"chat/push"===r&&!m&&!c||3===d.op&&"site/auth"===r&&!m&&!c||1===d.op&&"site/st"===r&&!m&&!c){var u=document.createElement("img");return void(u.src=h)}if("imgCross"===l)o.imgRequest(h);else o.jsonp(h,s)}else{if(s.method=s.method||"POST",s.method===i)s.data=a.stringify(d),h=h+"?v="+d.v;else h+=h.indexOf("?")>=0?"&":"?",h+=exports.jsonToQuery(d),h+="&v="+d.v;if(s.setCookie)h=h+"&s="+d.s,h=h+"&t="+s.setCookie;o.request(h,s)}},exports.auth=function(e,t,i,n){var o;if(0===e.visitType)o=t?0:1;else o=t?2:3;var a,r={success:i,failure:n,data:{op:o,dev:e.platform,ser:e.server}};if(!t)r.method="GET",a="imgCross";exports.request("site/auth",r,a)},exports.poll=function(e,t,i){var n={success:t,failure:i,data:{l:e?1:0}};exports.request("site/poll",n)},exports.site=function(e,t,i,n){var o,a={success:i,failure:n,data:{op:e?0:1,s_info:t,url:location.href}};if(!e)a.method="GET",o="imgCross";exports.request("site/st",a,o)},exports.chat=function(e,t,i){var n={success:t,failure:i,data:e};exports.request("chat/st",n)},exports.pick=function(e,t,i,n){var o={success:i,failure:n,data:{l:1,sid:t||""}};if(e.isPageOnload||!e.isSessionConnected)exports.request("chat/poll",o);else o.data.l=0,setTimeout(function(){exports.request("chat/poll",o)},3e3)},exports.push=function(e,t,i){var n={success:t,failure:i,data:e||{}};if(2===e.type)n.method="GET";exports.request("chat/push",n)},exports.node=function(e,t,i){var n={success:t,failure:i,data:e||{}};exports.request("bookmanage/saveBook.action",n)},exports.upload=function(e,t,i,n,o,a){t.upload(e.urlRoot+i,n,"file",o,a)},exports.getUploadUrl=function(e,t,i,n){return n=n||t.uuid(),e.urlRoot+"wupload/"+n+"/"+i.get("sid")},exports.getDownloadUrl=function(e,t,i,n,o){return n=n||t.uuid(),o=o||n,e.urlRoot+"wdownload/"+n+"/"+i.get("sid")+"/"+n+"?response-content-disposition=attachment;filename="+o},exports.log=function(e,t,i){var n=t+"/eye/log/js/stat.gif?";n+=exports.jsonToQuery(i),e.imgRequest(n)},exports}),define("im-core/chat",["require","im-lib","./config","./net"],function(require){function e(e){if(!e&&V.connected)exports.emit("disconnect");V.stopPick=!0,V.connected=!1,V.sid=""}function t(){if(!V.connected)if(V.csonline)if(!V.csonline||V.online)V.connected=!0,exports.emit("connected",{sid:V.sid}),u.each(V.msgPool,function(e){exports.emit("message",e)}),V.msgPool=[]}function i(t,i){var n={type:t};if(i)n.data=i;exports.emit("error",n),e()}function n(e,t){if(!e.pickType)V.sid=e.sid,V.to=e.uid,V.authType=e.authtype,V.csonline=!0,V.ttype=e.ttype;if(t)p.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{}}function o(){v={ifIR:!1,count:0,id:null}}function a(e){var t={},i=e.length-1;return u.each(e,function(n,o){var a=n.content.bcsName;if("img"===n.content.type&&!t[a]){if(o>=i)return I.push(e[i]),e;u.each(e,function(i,n){if("string"==typeof i.content){var r=document.createElement("div");r.innerHTML=i.content;var s=r.getElementsByTagName("img")[0];if(s&&s.tagName&&"IMG"===s.tagName.toUpperCase()&&s.id===a){var l=e.splice(o,1);e.splice(n,0,l[0]),t[a]=1}}})}}),e}function r(e){var t;if(e&&1===e.status&&"auth invalid"===e.errinfo)i("offline"),t=!0;return t}function s(e){if(E=0,C)C=!1,exports.emit("reconnect");if(exports.isConnected()){var t=V.options.siteid;if(t)m.localStorage.setItem("ACTIVE_"+t,+new Date)}u.each(e,function(e){var t=e.type,i=K[t];if(i)i(e.msg)}),h()}function l(e){if(E++,E>S&&!C)C=!0,exports.emit("offline");if(!r(e))setTimeout(function(){h()},3e3)}function h(){if(!V.stopPick)setTimeout(function(){f.pick(V.sid,s,l)},0)}var c,m=require("im-lib"),d=m.Emitter,u=m.lang,p=require("./config"),f=require("./net"),V={connected:!1,stopPick:!1,csonline:!1,msgPool:[]},U={INVITE:18,ACCEPT:20,BYE:28},g={OVER:4,TAKE_OVER:3,TRANSFER:6,RECEIVE:2},y="blocked",b="auto",k={SUCCESS:0,FAILURE:1},_={QUEUEING:2,TALKING:4},x=10,v={ifIR:!1,count:1,id:null},L={CSR:0,GROUP:1,IR:4},w={READY:0,BUSY:1,LEAVE:2,UNLOGIN:3},W={TRANSFER:0,CONVERSATION:1},X={COUNT:0,LIST:1,MSG_SYNC:0,END_TIME:0,PAGE:20,DEFAULT:5,DELAY:2e3},I=[],exports={};d.mixin(exports),f.on("auth invalid",function(){V.stopPick=!0});var K={};K[100]=function(e){if(e.op===U.ACCEPT)if(e.st===k.SUCCESS)X.END_TIME=e.systime||0,V.sid=e.sid,V.to=e.uid,V.authType=e.authtype,V.csonline=!0,V.online=!0,p.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},exports.fetchOfflineMsg(),X.MSG_SYNC=e.systime||0;else exports.bye();if(e.op===U.BYE)if(e.st===k.SUCCESS){var t=V.options||{};if("talk to other"===e.reason)V.stopPick=!1,t.invited=0,t.tid=p.tid,t.ttype=1,t.sid="",t.from=4,exports.connect(t.ttype,t,!1)}else exports.emit("invitefail");if(e.op===U.INVITE){if(X.END_TIME=e.systime||0,"queue"===e.reason)return;if(e.ttype===L.IR)v.ifIR=!0,v.id=e.uid,exports.emit("currentIR");if("re_invite"===e.reason&&p.status===_.QUEUEING)return void exports.emit("queueing");if("re_invite"===e.reason){if(p.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},V.sid=e.sid,V.to=e.uid,V.authType=e.authtype,V.tid=p.tid||"",V.ttype=e.ttype,V.csonline=!0,V.online=!0,p.syncSessionHistory)exports.fetchSessionMessage();return void exports.fetchOfflineMsg()}if(e.st===k.SUCCESS)V.sid=e.sid,V.to=e.uid,V.authType=e.authtype,V.csonline=!0,V.ttype=e.ttype,p.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{};else{var i=m.json.parse(e.adata||"{}");return V.to=i.uid||"-1",V.authType=e.authtype,V.csonline=!1,exports.emit("csoffline"),void exports.fetchOfflineMsg()}exports.fetchOfflineMsg()}},K[101]=function(t){if(t.msgHandlerType=t.msgHandlerType||"",t.opr===g.OVER)if(t.reason&&-1!==t.reason.indexOf(y))exports.emit("visitorblock",t),e();else if(t.reason&&-1!==t.reason.indexOf(b))exports.emit("autoendtalk",t),e();else i("forceover");else if(t.opr===g.TAKE_OVER)if(n(t,!0),v.ifIR)o(),exports.emit("fininshIR",{type:"invite"});else exports.emit("updateNewCSR",p.sinfo);else if(t.opr===g.TRANSFER)if(n(t,!0),v.ifIR)o(),exports.emit("fininshIR",{type:"online"});else exports.emit("updateNewCSR",p.sinfo);else if(t.opr===g.RECEIVE){var a=t.detail||{};if(a.join_action===W.TRANSFER){var r=!1,s=t.adata&&m.json.parse(t.adata)||{},l=s.transfer||{},h=t.sinfo&&m.json.parse(t.sinfo)||{};if(l.status)r=!0,exports.emit("visitorTransfer",{nickname:h.nickname||""},t.msgHandlerType);n(t,r)}}},K[103]=function(e){if(V.connected){if(exports.emit("message",e),v.ifIR&&e.from===v.id&&v.count)if(++v.count>=5)exports.emit("showMsgRemind",v.count),v.count=0}else V.msgPool.push(e)},K[104]=function(e){if(p.status=e.status,e.status===_.QUEUEING)V.sid=e.sid,V.queueing=!0,exports.emit("queueing");if(e.status===_.TALKING)if(V.queueing=!1,V.sid=e.sid,V.online=!0,t(),v.ifIR)if(""!==e.reason)exports.emit("transferError",e)},K[105]=function(e){if(c)clearTimeout(c),c=null;var t=e.detail||[];if(e.type===X.COUNT){var i=0;if(u.each(t,function(e,t){i+=e.count}),i<X.DEFAULT)i=X.DEFAULT;if(i>X.PAGE)i=X.PAGE;exports.fetchHistory({count:i})}else if(e.type===X.LIST){var n=t.length;if(t[0])X.MSG_SYNC=t[0].systime||X.MSG_SYNC;if(t[n-1])X.END_TIME=t[n-1].systime||X.END_TIME;t=I.concat(t),I=[], t=a(t),u.each(t,function(e,t){e.msgHandlerType="insertBefore",exports.emit("message",e)}),exports.fetchHisFinish(!0,e)}},K[106]=function(e){V.sid=e.sid,V.to=e.uid,V.authType=e.authtype,V.csonline=!0,p.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},exports.fetchOfflineMsg()},K[107]=function(e){if(e.webmsg){var t=m.json.parse(e.webmsg);t.body.reverse(),u.each(t.body,function(e){var t=e.msg;t.msgHandlerType="insertBefore",t.time=parseInt(+t.time/1e3,10);var i=e.msg.content;if(m.lang.isArray(i))u.each(i,function(e){var i=e.pickType;if(i){var n=K[i];if(e.msgHandlerType="insertBefore",n)n(e)}else t.content=e.content||e,t.mtype=e.mtype||0,exports.emit("message",t)})})}},K[108]=function(e){if(v.ifIR&&e.status===w.READY)exports.emit("csonline",e,"IR");else if(!V.connected&&e.status===w.READY)exports.emit("csonline",e,"OFFLINE_MSG")},exports.receiveOfflineMsg=function(e){var t={sid:"",tid:V.tid,type:e.PUSH_TYPE_MSG_SYNC,tid_authtype:p.authType,param:{systime:X.MSG_SYNC}};f.push(t,null,null)},exports.fetchHisFinish=function(e,i){if(i=i||{},e)exports.receiveOfflineMsg(),exports.emit("fetchhistorysuccess");else exports.emit("fetchhistoryfail");exports.emit("fetchhistoryfinish",i),t()},exports.fetchHistory=function(e,t){t=t||{};var i=p.offlineMsgGetType||0,n=i?"":V.sid,o=i?"-1":V.tid,a=i?p.bid:V.to,r={sid:n,tid:o,type:e.PUSH_TYPE_FETCH_HISTORY,tid_authtype:p.authType,param:{type:1,gettype:i,from:a,max_count:t.count||x,from_authtype:V.authType,endtime:X.END_TIME}};f.push(r,null,exports.fetchHisFinish)},exports.fetchSessionMessage=function(e){var t=V.tid||"",i=t,n="";if(t.indexOf(":")){var o=t.split(":");i=o[0],n=o[1]||""}var a=m.json.stringify({tag:1,type:2,userId:i-0,subId:n-0,bid:p.bid}),r={sid:V.sid,tid:V.tid,type:e.PUSH_TYPE_FETCH_SESSION_MESSAGE,tid_authtype:p.authType,param:{webmsg:a}};f.push(r)},exports.bye=function(e){var t={sid:V.options.sid,tid:V.tid,type:e.PUSH_TYPE_BYE,tid_authtype:p.authType,param:{reason:"bye for invite error"}};f.push(t)};var E=0,C=!1,S=3;return exports.pick=h,exports.connect=function(e,t,n,o){n=n||{},V.tid=n.tid||"",V.options=n;var a={op:0,sid:n.sid||"",tid:V.tid,tid_authtype:p.authType,invited:n.invited-0?1:0,rtype:n.route||0,ttype:t,inviterefer:document.referrer,reason:p.reasons[n.from]||e.CHART_START_TYPE};f.chat(a,function(){if(o!==!1)V.stopPick=!1,h()},function(){i("connect")})},exports.talking=function(e,i){if(i=i||{},e=e||{},p.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},V.sid=e.sid,V.to=i.tid,V.authType=e.authtype,V.csonline=!0,V.online=!0,V.tid=e.tid||"",V.options=i,V.stopPick=!1,p.syncSessionHistory)exports.fetchSessionMessage();t(),h()},exports.queue=function(e,t){t=t||{},e=e||{},p.sinfo=e.sinfo&&m.json.parse(e.sinfo)||{},V.sid=e.sid,V.to=e.uid,V.authType=e.authtype,V.csonline=!0,V.tid=e.tid||"",V.options=t,V.stopPick=!1,exports.emit("queueing"),h()},exports.preSend=function(e,t){if(t.content){t.mtype=0,t.to=V.to,t.time=(new Date).getTime(),t.rtype=V.ttype;var i={sid:V.sid||"",tid:V.to,type:e.PUSH_TYPE_PRE_SEND,tid_authtype:V.authType,param:t};f.push(i)}},exports.send=function(e,t,i,n){t.from=p.bid,t.to=V.to,t.time=(new Date).getTime(),t.rtype=V.ttype;var o={sid:V.sid||"",tid:V.to,type:V.csonline?e.PUSH_TYPE_CHAT:e.PUSH_TYPE_OFFLINE,tid_authtype:V.authType,param:t};if(void 0!==t.adata)o.adata=t.adata,delete t.adata;f.push(o,i,function(e){if(r(e),n)n()})},exports.disconnect=function(t,i,n){t=t||{};var o=void 0===t.tid_authtype?V.authType:t.tid_authtype;o=o||4,f.push({type:2,sid:t.sid||V.sid,tid:t.tid||V.to||-1,reason:t.reason||"",tid_authtype:o},i,n),e(!0)},exports.isConnected=function(){return V.connected},exports.get=function(e){return V[e]},exports.setStopPick=function(e){V.stopPick=e},exports.fetchOfflineMsg=function(e){if(p.syncFetchOfflineMsg){var i={sid:"",tid:"-1",type:e.PUSH_TYPE_FETCH_HISTORY,tid_authtype:p.authType,param:{type:X.COUNT,from:V.to,from_authtype:V.authType}};f.push(i,null,exports.fetchHisFinish),c=setTimeout(function(){t()},X.DELAY)}else t()},exports}),define("im-core/plugin/img",["require","im-lib","../chat","../net","im-core/chat","../main"],function(require){function e(e){return e=e.split(m?"\\":"/"),e.pop()}function t(e){return"wupload/"+e+"/"+r.get("sid")}function i(e,t){var i=require("im-core/chat");return t=t||"a.jpg","wdownload/"+e+"/"+i.get("sid")+"/"+t}function n(i,n){var o=(e(i.path),i.bcsName),a=t(o);l[a]={msg:i,done:n};var r='<img id="'+o+'" data-uploaded="0" data-bcsName="'+o+'"/>',m={mtype:0,content:r};n(m);var d={mtype:c,content:{type:h,bcsName:o}},u=require("../main");s.upload(a,i.form||i.path,function(){d.content.status=0,n(d),u.emit("imgsendsuccess",{bcsName:o,id:i.mid})},function(){d.content.status=1,n(d),u.emit("imgsendfail",{bcsName:o,id:i.id})})}function o(e,t){var n=e.content,o=n.bcsName,a=i(o,"img");t({type:h,bcsName:o,bcsUrl:a,status:n.status})}var a=require("im-lib").Emitter,r=require("../chat"),s=require("../net"),l={},h="img",c=1,m=/ window nt/i.test(navigator.userAgent),exports={};return a.mixin(exports),exports.encoder={},exports.encoder[h]=n,exports.decoder={},exports.decoder[h]=o,exports}),define("im-core/plugin/shake",["require","../main"],function(require){function e(e,t){t({mtype:n,content:{type:i}})}function t(e,t){var i=require("../main");i.emit("shake",e.msgHandlerType||""),t()}var exports={},i="shake",n=4;return exports.encoder={},exports.encoder[i]=e,exports.decoder={},exports.decoder[i]=t,exports}),define("im-core/plugin/text",["require","../chat","../config","im-core/chat"],function(require){function e(e,t){var i=document.createElement("div");i.innerHTML=e.text||"";for(var n=i.getElementsByTagName("img"),o=n.length;o;o--){var a=n[o-1];if(a.getAttribute("data-bcsName")){var s=document.createElement("img");s.setAttribute("data-bcsName",a.getAttribute("data-bcsName")),s.setAttribute("data-uploaded",a.getAttribute("data-uploaded")),s.id=a.id,a.id="";var l=a.parentNode;l.insertBefore(s,a),l.removeChild(a)}}t({mtype:r,content:i.innerHTML.replace(/\r|\n/gi,"")||""})}function t(e,t){var i=require("im-core/chat");return t=t||"a.jpg",o.urlRoot=o.urlRoot||"",o.urlRoot+"wdownload/"+e+"/"+i.get("sid")+"/"+t}function i(e){var i=document.createElement("div");i.innerHTML=e;for(var n=i.getElementsByTagName("img"),o=0;o<n.length;o++){var a=n[o],r=a.getAttribute("data-bcsName"),s=a.getAttribute("data-bcsUrl");if(r&&!s)s=t(r,r),a.setAttribute("data-bcsUrl",s)}return i.innerHTML}function n(e,t){var n=(require("../chat"),i(e.content)),r=e.from===o.bid?0:1;t({type:a,role:r,time:1e3*e.time,text:n||""})}var o=(require("../chat"),require("../config")),a="text",r=0,exports={};return exports.encoder={},exports.encoder[a]=e,exports.decoder={},exports.decoder[r]=n,exports}),define("im-core/plugin/transfer",[],function(){function e(e,t){t({mtype:n,content:{type:i}})}function t(e,t){t()}var exports={},i="transfer",n=4;return exports.encoder={},exports.encoder[i]=e,exports.decoder={},exports.decoder[n]=t,exports}),define("im-core/plugin/uploaded",[],function(){function e(e,t){t({mtype:n,content:{type:i,bcsName:e.bcsName,status:0}})}function t(e,t){t()}var exports={},i="img",n=1;return exports.encoder={},exports.encoder.uploaded=e,exports.decoder={},exports.decoder.uploaded=t,exports}),define("im-core/plugin/voice",["require","../config"],function(require){function e(e,t){t({mtype:o,content:e})}function t(e,t){var o=e.content,s=e.from===i.bid?0:1;t({type:n,role:s,text:a+o.text,bcsName:o.bcsName,fetchURL:r.replace(/#{bcsName}/g,o.bcsName),duration:o.duration,token:o.token})}var i=require("../config"),n="voice",o=2,a="\u8bed\u97f3\u8f6c\u8bd1\uff1a",r='//p.qiao.baidu.com/cps/audio/getAudio?reqParam={"audioName": "#{bcsName}"}',exports={};return exports.encoder={},exports.encoder[n]=e,exports.decoder={},exports.decoder[n]=t,exports}),define("im-core/plugin/location",["require","../config"],function(require){function e(e,t){t({mtype:o,content:e})}function t(e,t){var o=e.from===i.bid?0:1;e.content.type=n,e.content.role=o,e.content.text=a,t(e.content)}var i=require("../config"),n="location",o=4,a="[\u5730\u7406\u4f4d\u7f6e]",exports={};return exports.encoder={},exports.encoder[n]=e,exports.decoder={},exports.decoder[n]=t,exports}),define("im-core/plugin/config",["require","./fileTransfer","./unknownMsg","./img","./shake","./text","./transfer","./uploaded","./voice","./location"],function(require){return{"package":"coreplugin",resource:{fileTransfer:require("./fileTransfer"),unknownMsg:require("./unknownMsg"),img:require("./img"),shake:require("./shake"),text:require("./text"),transfer:require("./transfer"),uploaded:require("./uploaded"),voice:require("./voice"),location:require("./location")}}}),define("im-lib/config",["require","./lang","./json","./net","./util","./Emitter","./localStorage","./main"],function(require){return{"package":"imLib",resource:{lang:require("./lang"),json:require("./json"),net:require("./net"),util:require("./util"),Emitter:require("./Emitter"),localStorage:require("./localStorage"),main:require("./main")}}}),define("im-core/auth",["require"],function(require){var e={},exports={};return exports.get=function(t,i){var n={anonym:t.anonym,key:e.key||"",sn:e.sn||"",id:t.bid||"",from:t.authType,token:t.authToken||""};if(i)return n[i];else return n},exports.set=function(t,i){e[t]=i},exports}),define("im-core/message",["require"],function(require){function e(){}function t(t,i){return t=t||e,i=i||e,function(e){if(e===!1)i();else if(e)t(e)}}var i=1,n=2,o=4,a={},r={},exports={};return exports.encode=function(e,i,n){var o=a[e.type];if(!o)throw e.type+" message not supported";o(e,t(i,n))},exports.decode=function(e,a,s){var l=e.mtype;if(l===i||l===o||l===n)if(e.content&&e.content.type)if(l=e.content.type,"file"===l)l="fileTransfer";var h=r[l];if(h)h(e,t(a,s));else if(s)s()},exports.addEncoder=function(e,t){e.each(t,function(e,t){a[e]=t})},exports.addDecoder=function(e,t){e.each(t,function(e,t){r[e]=t})},exports}),define("im-core/site",["require"],function(require){var exports={};return exports.init=function(e,t,i){t.extend(e,i||{}),e.anonym=e.bid?0:1},exports.enter=function(e,t,i){if(t=t||function(){},i=i||function(){},e.isLogin())t();else e.login(t,i)},exports.leave=function(e){if(e.isLogin())e.logout()},exports}),define("im-core/user",["require","./net"],function(require){function e(){clearTimeout(i),i=null,n=!1}var exports={},t=require("./net");t.on("auth invalid",function(){e()});var i,n,o={INVITE:1,AUTH:2},a="blocked";exports.heartBeat=function(e){function t(){i=setTimeout(exports.heartBeat,15e3)}e.poll(!1,t,t)};var r={};return exports.refresh=function(e,t,i){function o(){t.poll(a,function(t){e.each(t,function(e){var t=r[e.type+""];if(t)t(e.msg)}),exports.refresh()},function(){setTimeout(exports.refresh,3e3)})}if(n){var a=Boolean(i.isPageOnload);if(a)o();else setTimeout(o,3e3)}},exports.pickHandler1=function(e,t,i,n){if("invite"===n.reason)i.sid=n.sid,i.tid=n.uid,i.fromType=2,i.ttype=0,e.emit("initiative",n);else if("chat"===n.reason)i.sid=n.sid,i.tid=n.uid,i.ttype=n.ttype,i.invited=1,i.sinfo=n.sinfo&&t.parse(n.sinfo)||{},e.emit("forcetalk",n)},exports.pickHandler104=function(e,t,i){t.status=i.status,e.emit("watchStatus",i)},r[1]=function(e){exports.pickHandler1(e)},r[104]=function(e){exports.pickHandler104(e)},exports.getInfo=function(e){function t(){var e=(new Date).getTimezoneOffset(),t=parseInt(e/60,10),i=e%60,n="-";if(0>t||0>i)if(n="+",t=-t,0>i)i=-i;return t+="",i+="","UTC"+n+t+":"+i}var i=window.navigator,n=window.screen,o={lang:i.language||i.systemLanguage,cbit:n.colorDepth,rsl:n.width+"*"+n.height,tz:t(),referrer:encodeURIComponent(document.referrer)};return o},exports.enter=function(e,t,i){e.site(!0,exports.getInfo(),function(){exports.getEnterResult(t,i)},i)},exports.checkEnterResult=function(e,t,i,o,a){var r=!1;return e.each(i,function(i){if(100===i.type){var s=i.msg||{};if(3===s.status&&0===t.visitType){var l=t.tid||"",h=t.sid||"";e.extend(t,s),t.tid=l,t.sid=h}else e.extend(t,s);if(r=!0,n=!0,0===t.visitType)exports.heartBeat();else exports.refresh();o(i.msg)}else a()}),r},exports.checkAuthResult=function(e,t,i,n,r,s){var l=!1;return e.each(i,function(e){if(e.type===o.AUTH){if(l=!0,e=e.msg||{},e.reason&&-1!==e.reason.indexOf(a))return void(s&&s());if(e.valid)t.bid=e.v,exports.enter(n,r);else r()}}),l},exports.getEnterResult=function(e,t,i){e.poll(!0,function(e){if(!exports.checkEnterResult(e,t,i))exports.getEnterResult(t,i)},i)},exports.getAuthResult=function(e,t,i,n){e.poll(!0,function(e){if(!exports.checkAuthResult(e,t,i,n))exports.getAuthResult(t,i,n)},i)},exports.isLogin=function(){return!!i||n},exports.login=function(e,t,i,n,o,a){if(!exports.isLogin())e.auth(!0,function(e){t.set("key",e.key),i.bid=e.v,exports.getAuthResult(n,o,a)},o);else n()},exports.logout=function(t){e(),t.site(!1),t.auth(!1)},exports}),define("im-core/log",["require"],function(require){var exports={};return exports.send=function(){},exports}),define("im-core/bullConfig",["require","./plugin/config","im-lib/config","./main","./auth","./config","./const","./chat","./message","./site","关于我们.htmler","./net","./log"],function(require){return{"package":"core",importConfig:[require("./plugin/config"),require("im-lib/config")],resource:{main:require("./main"),auth:require("./auth"),config:require("./config"),consts:require("./const"),chat:require("./chat"),message:require("./message"),site:require("./site"),user:require("关于我们.htmler"),net:require("./net"),log:require("./log")},injection:[{id:"core.main",method:{initCore:["core.chat","core.config","imLib.lang","core.consts"],connect:["core.chat","core.config","core.user"],auth:["core.user"],send:["core.chat","core.message"],addPlugin:["coreplugin.fileTransfer","coreplugin.img","coreplugin.unknownMsg","coreplugin.shake","coreplugin.text","coreplugin.transfer","coreplugin.uploaded","coreplugin.voice","coreplugin.location"],preSend:["core.chat","core.message"],plugin:["core.message"],disconnect:["core.chat","core.user"],messageHandler:["core.config"],get:["core.chat"],bindEvent:["core.main","communicate.handler"],isConnected:["core.chat"],sendOfflineMsg:["core.chat","core.message"],fetchHistory:["core.chat"]}},{id:"core.auth",method:{get:["core.config"]}},{id:"core.chat",method:{fetchHistory:["core.consts"],connect:["core.consts"],fetchSessionMessage:["core.consts"],bye:["core.consts"],preSend:["core.consts"],send:["core.consts"],fetchOfflineMsg:["core.consts"],receiveOfflineMsg:["core.consts"]}},{id:"core.message",method:{addEncoder:["imLib.lang"],addDecoder:["imLib.lang"]}},{id:"core.net",method:{jsonToQuery:["imLib.json","imLib.lang"],getUploadUrl:["core.config","imLib.util","core.main"],getDownloadUrl:["core.config","imLib.util","core.main"],request:["core.config","core.auth","imLib.net","imLib.json"],auth:["core.config"],authOut:["core.user"],upload:["core.config","imLib.net"],initLog:["core.config","data.config"],log:["imLib.net"],pick:["core.config"]}},{id:"core.site",method:{init:["core.config","imLib.lang"],enter:["core.user"],leave:["core.user"]}},{id:"core.user",method:{refresh:["imLib.lang","core.net","core.config"],getInfo:["imLib.lang"],enter:["core.net"],checkEnterResult:["imLib.lang","core.config"],getAuthResult:["core.net"],login:["core.net","core.auth","core.config"],logout:["core.net"],getEnterResult:["core.net"],pickHandler1:["core.main","imLib.json","core.config"],pickHandler104:["core.main","core.config"],heartBeat:["core.net"],checkAuthResult:["imLib.lang","core.config"]}}],aspect:[{id:"core.message",pointCut:["core.main.decode, , decode"]},{id:"core.net",pointCut:["core.log.send, ,log"]}]}}),define("base/mobile/brower",[],function(){var e,t=document,i=new RegExp("msie (\\d+\\.\\d+)|trident","i");return{ie:function(){return i.test(navigator.userAgent)?t.documentMode||+RegExp.$1:e}(),isBDBox:/ baiduboxapp\//i.test(navigator.userAgent),opera:/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(navigator.userAgent)?+(RegExp.$6||RegExp.$2):void 0,isStrict:function(){return"CSS1Compat"===t.compatMode},isMobile:function(){var e=navigator.userAgent;return!!e.match(/.*Mobile.*/)||"ontouchstart"in window}(),isIos:!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)}}),define("base/mobile/dom",["require"],function(require){var exports={};return exports.hide=function(e,t){if(e.isType(t,"Array"))for(var i=t.length;i--;){var n=this.g(t[i]);n&&(n.style.display="none")}},exports.show=function(e,t){if(e.isType(t,"Array"))for(var i=t.length;i--;){var n=this.g(t[i]);n&&(n.style.display="block")}},exports.appendHTML=function(e,t){e=e||"";var i=document.createElement("div");if(i.innerHTML=e,t)for(;i.firstChild;)t.appendChild(i.firstChild);return i.childNodes},exports.g=function(e,t){var i=null;if("string"==typeof t)i=document.getElementById(t);else if(e.isType(t,"HTML"))i=t;else if(t===window)i=t;return i},exports.setStyle=function(e,t){if(e.classList)e.classList.add(t);else{var i=e.className,n=i.split(/\s/);if(-1===n.indexOf(t))n.push(t),e.className=n.join(" ")}},exports}),define("base/mobile/event",["require","exports"],function(require,exports){function e(e,t,i){var n;return function(){var o=this,a=arguments,r=function(){if(n=null,!i)e.apply(o,a)},s=i&&!n;if(clearTimeout(n),n=setTimeout(r,t),s)e.apply(o,a)}}var t={};exports.on=function(e,i){(t[e]=t[e]||[]).push(i)},exports.off=function(e,i){var n=[].slice.call(arguments,0).length;if(0===n.length)return void(t=[]);if(1===n.length)return delete t[e],t;else return void 0},exports.trigger=function(e){var i=[].slice.call(arguments,1),n=t[e];if(n)for(var o=n.length;o--;)n[o].call(this,i)},exports.domOn=function(t,i,n,o,a){var r=[];if(-1!==Object.prototype.toString.call(i).indexOf("Array"))for(var s=i.length;s--;)r.push(i[s]);else r.push(i);for(var l=r.length;l--;){var h=t.g(r[l]);if(h){if(a)o=e(o,100);h.addEventListener(n,o,!1)}}},exports.domOff=function(e,t,i,n){var o=e.g(t);if(o)o.removeEventListener(i,n,!1)},exports.getTarget=function(e){e=e;var t=e.target;return t}}),define("base/mobile/lib",["require"],function(require){var exports={};return exports.getBid=function(){var e,t=(+new Date).toString(),i=Math.floor(1e5*Math.random()).toString(),n=5-i.length;if(n>0)for(e=0;n>e;e++)i+="0";return t+i},exports.uuid=function(){for(var e=[],t="0123456789abcdef",i=0;36>i;i++)e[i]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n},exports.isType=function(e,t){return{}.toString.call(e).indexOf("[object "+t)>=0},exports.extend=function(e,t){for(var i in t)if(t.hasOwnProperty(i)&&"_belong"!==i)e[i]=t[i];return e},exports}),define("base/baseMobileConfig",["require","./mobile/brower","./mobile/dom","./mobile/event","./mobile/lib"],function(require){return{"package":"mbase",resource:{brower:require("./mobile/brower"),dom:require("./mobile/dom"),events:require("./mobile/event"),lib:require("./mobile/lib")},injection:[{id:"mbase.events",method:{domOn:["mbase.dom"],domOff:["mbase.dom"]}},{id:"mbase.dom",method:{hide:["mbase.lib"],show:["mbase.lib"],g:["mbase.lib"]}}]}}),define("common/util",[],function(){function e(e,t){for(var i,n=/<%([^%>]+)?%>/g,o=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,a="var r = [];\n",r=0,s=function(e,t){return t?a+=e.match(o)?e+"\n":"r.push(data."+e+");\n":a+=""!==e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",s};i=n.exec(e);)s(e.slice(r,i.index))(i[1],!0),r=i.index+i[0].length;s(e.substr(r,e.length-r)),a+='return r.join("");';var l=new Function("data",a.replace(/[\r\t\n]/g,""));return l(t)}function t(e){for(var t={},i=e.length;i--;){var n=e[i];if(-1!==Object.prototype.toString.call(n).indexOf("Object"))for(var o in n)if(n.hasOwnProperty(o))t[o]=n[o]}return t}function i(e,t){if(e){for(var i="",n=e.split("<!-- end -->"),o=n.length;o--;){var a=n[o];if(a){if(1===arguments.length)t=a.match(/\w{0,}( \-\->)/g)[0].match(/\w/g).join("");var r="<!-- target: "+t+" -->";if(-1!==a.indexOf(r))i=a}else;}return i}return""}function n(e,t){var i={};i.phoneReg=/(^(\d{3,4}(-?))?\d{7,8})$|^((\+86)|(86))?(1[0-9][0-9]{9})/,i.emailReg=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;var n=t.match(i[e]);if(null!=n)return!0;else return!1}function o(e){if("string"!=typeof e)return e;else return e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/\"/g,"&quot;"),e=e.replace(/\'/g,"&apos;")}function a(e){var t={};if("object"==typeof e)for(var i in e)if(e.hasOwnProperty&&e.hasOwnProperty(i))if("object"==typeof e[i])t[i]=a(e[i]);else t[i]=e[i];return t}var r=function(e){if("string"!=typeof e)return"";var t=document.createElement("a");return t.href=e,t.hostname},s=function(e){return/\{\s*\[native code\]\s*\}/.test(""+e)},l=function(e){var t=new RegExp("(^[\\s\\t\\xa0\\u3000]+)|([\\u3000\\xa0\\s\\t]+$)","g");return String(e).replace(t,"")},h=function(e){if(e=e||{},!e.x||!e.y)return"";else return"//map.baidu.com/mobile/webapp/place/marker/qt=inf&vt=map&act=read_share&code=/point="+encodeURIComponent(e.x+"|"+e.y)+"&title="+encodeURIComponent(e.name||"")+"&content="+encodeURIComponent(e.alias||"")},c=function(e){if(e=e||{},!e.x||!e.y)return"";var t=e.x,i=e.y,n=e.zoom||15,o=e.width||220,a=e.height||110,r=e.style||"-1,//qiao.baidu.com/site/pinpc.png,-1";return"//api.map.baidu.com/staticimage?width="+o+"&height="+a+"&center="+t+","+i+"&markers="+t+","+i+"&zoom="+n+"&markerStyles="+r},m=function(e){return"number"==typeof e&&+e!==+e},d=function(){var e=!1;if(e="complete"===document.readyState,document.documentElement.doScroll)try{document.documentElement.doScroll("left"),e=!0}catch(t){e=!1}return e};return{template:e,pickHtml:i,regext:n,filterXSS:o,extend:t,cloneObj:a,getHost:r,isNativeFun:s,trim:l,getLocationUrl:h,getLocationImgUrl:c,isNaN:m,checkLoad:d}}),define("lib/util",["common/util"],function(e){return e}),define("common/tpl",[],function(){var exports={},e={};return exports.parse=function(t){t=t||"";var i=0,n="";t.replace(/<\!\-\-\s*target:\s*(\w+)\s*\-\->/g,function(o,a,r){if(0!==r)e[n]=t.substring(i,r);n=a,i=r}),e[n]=t.substring(i,t.length)},exports.get=function(t){return e[t]||""},exports}),define("lib/tpl",["common/tpl"],function(e){return e}),define("common/view",["require"],function(e){var exports={},t="newBridge";return exports.getWrap=function(e){var i=e.g(t);return i},exports}),define("lib/view",["common/view"],function(e){return e}),define("common/cookie",[],function(){var exports={};return exports.get=function(e){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),i=t.exec(document.cookie);return i?decodeURIComponent(i[2]):null},exports.set=function(e,t,i){i=i||{};var n;if(i.expires)if(n=i.expires,"number"==typeof n)n=new Date,n.setTime(i.expires+n.getTime());document.cookie=e+"="+encodeURIComponent(t)+(i.path?"; path="+i.path:"")+(i.expires?"; expires="+i.expires.toGMTString():"")+(i.domain?"; domain="+i.domain:"")+(i.secure?"; secure":"")},exports}),define("lib/cookie",["common/cookie"],function(e){return e}),define("common/mobileConfig",["require","./util","./tpl","./view","./cookie"],function(require){return{"package":"common",resource:{util:require("./util"),tpl:require("./tpl"),view:require("./view"),cookie:require("./cookie")},injection:[{id:"common.view",method:{getWrap:["mbase.dom"]}}]}}),define("lib/mobileConfig",["common/mobileConfig"],function(e){return e}),define("embed/data/config",["require"],function(require){var exports={};return exports.staticDomain="//sgoutong.baidu.com",exports.getServer=function(e,t){var i=e.getWrap();return i={configBox:i.config,siteObj:i.siteConfig,startTime:i.startTime},i[t]||i},exports.isAutoInvite=function(){var e=exports.getServer("configBox");return!!(e.inviteBox.autoInvite-0)},exports}),define("embed/data/bullConfig",["require","./config"],function(require){return{"package":"data",resource:{config:require("./config")},injection:[{id:"data.config",method:{getServer:["common.view"]}}]}}),define("embed/embedChat/bid",["require"],function(require){function e(e,t,i){var n=i.OLDBIDKEY+e+"_BID",o=t.getItem(n);if(!o)return o;else return o=parseInt(o.substr(0,13),16).toString()}var exports={};return exports.init=function(t,i,n,o,a,r,s){if(i.isObject(s)&&"undefined"!=typeof r&&""!==r)return r;var l=o.BIDPRE+a;if(!r)r=t.getItem(l)||e(a,t,o)||n.getBid();return t.setItem(l,r),r},exports}),define("embed/embedChat/consts",[],function(){return{OLDBIDKEY:"QIAO_LS_",BIDPRE:"NEWBRIDGE_BID_",TALKTYPEPRE:"NEWBRIDGE_TALK_TYPE_",DOMAIN:"//sgoutong.baidu.com"}}),define("embed/embedChat/mobile/leave",["require"],function(require){var e,exports={};return exports.init=function(t,i,n,o){n.domOn(window,"unload",function(){if(!e){var n=!0;if("invite"===i.visitState&&o.isIos)n=!1;t.disconnect(n,!1),e=!0}})},exports}),define("embed/embedChat/mobile/chat",["require","exports"],function(require,exports){function e(){}function t(e){var t=e;if(/^https:/.test(e))t=e.replace(/^https/,"http");else if(/^\/\//.test(e))t="http:"+e;return t}var i={};exports.getDefaultParam=function(e){var t=e.getServer("siteObj");return{v:t.userId,s:t.siteId,dev:"1",type:0,sid:"-1",tid:"-1",tid_authtype:4}},exports.refuseSuccess=function(e,t,i){var n=e.g("nb_invite_wrap");n.style.display="none",t.fromType=1},exports.acceptSuccess=function(e,n,o,a){var r=o.getServer("siteObj"),s={};if(0===a[1])s.from=0;else s.from=e.fromType;s.sessionid=e.sid,s.siteId=r.siteId,s.tid=e.tid||"-1",s.userId=r.userId,s.ttype=e.ttype,i.reqParam=s;var l=r.webRoot+"chatIndex";l=t(l),window.open(l+"?"+n.jsonToQuery(i),"mbNBBridage")},exports.initSystemInvite=function(e){e.sid="-100",e.tid="-1",e.fromType=1,e.ttype=1},exports.watchStatus=function(e,t,i){var n=t.g("nb_invite_wrap");if(3===i.status||"invite"==i.reason)n.style.display="block",e.visitState="invite";else n.style.display="none",e.visitState="",exports.initSystemInvite()},exports.initiative=function(e,t,i){if(2===t.fromType||"to"===t.from){var n=e.g("nb_invite_wrap");n.style.display="block"}},exports.enterSuccess=function(e,t,i,n){if(n.length){var o=n[0].msg,a=e.g("nb_invite_wrap");if(void 0!=o.status)if(3===o.status)a.style.display="block",t.sid=o.sid,t.tid=o.tid,t.fromType=2,t.ttype=0;else if(4===o.status)a.style.display="none",clearTimeout(i.timeKey)}},exports.builtComunicate=function(e,t,i,n,o){var a=n.getServer("siteObj");e.siteid=a.siteId,e.bid=o.init(a.siteId,a.bid||e.bid,a.session),e.eid=a.eid,e.platform=1,e.urlRoot=a.webRoot,e.crossDomain=!0,e.visitType=1,t.init(e),i.init(e),i.enter(exports.enterSuccess),t.on("initiative",exports.initiative),t.on("watchStatus",exports.watchStatus)},exports.refuse=function(t,i){var n=exports.getDefaultParam();n.type=1,n.sid=t.sid,n.tid=t.tid,i.push(n,exports.refuseSuccess,e)},exports.accept=function(e,t){var i=exports.getDefaultParam();i.type=0,i.sid=e.sid,i.tid=e.tid,exports.acceptSuccess(arguments)}}),define("embed/embedChat/mConfig",["require","./bid","./consts","./mobile/leave","./mobile/chat"],function(require){return{"package":"mchat",resource:{bid:require("./bid"),consts:require("./consts"),leave:require("./mobile/leave"),chat:require("./mobile/chat")},injection:[{id:"mchat.chat",method:{builtComunicate:["core.config","core.main","core.site","data.config","mchat.bid"],watchStatus:["core.config","mbase.dom"],initiative:["mbase.dom","core.config"],refuse:["core.config","core.net"],accept:["core.config"],enterSuccess:["mbase.dom","core.config","minvite.data"],acceptSuccess:["core.config","core.net","data.config"],refuseSuccess:["mbase.dom","core.config"],initSystemInvite:["core.config"],getDefaultParam:["data.config"]}},{id:"mchat.leave",method:{init:["core.main","core.config","mbase.events","mbase.brower"]}},{id:"mchat.bid",method:{init:["imLib.localStorage","imLib.lang","mbase.lib","mchat.consts"]}}],aspect:[{id:"mchat.chat",pointCut:["minvite.main.init, , builtComunicate"]},{id:"mchat.leave",pointCut:["mchat.chat.builtComunicate, , init"]}]}}),define("embed/invite/inviteMain",["require"],function(require){var exports={};return exports.renderHtml=function(e,t,i,n,o,a){var r=t.getWrap(),s=i.getInviteStyle(),l=n.template(o,s);e.appendHTML(l,r),a.process()},exports.init=function(e){exports.renderHtml(),e.init()},exports}),define("embed/invite/inviteData",["require"],function(require){var exports={};return exports.getInviteStyle=function(e,t){var i=e.getServer("configBox").inviteBox,n=t.dataProcess(i);return n},exports}),define("embed/invite/inviteHandler",["require"],function(require){var exports={};return exports.bindEvent=function(e,t,i){i.process();var n=i.getClickEle();e.domOn(n,"click",i.acceptInvite,!1),e.domOn([t.PREFIXID+"cancel",t.PREFIXID+"tool"],"click",i.refuseInvite,!1)},exports.init=function(){exports.bindEvent()},exports}),define("embed/invite/mobile/inviteMMain",["require"],function(require){function e(e,i,n){clearTimeout(t);var o=0;if("show"===e){if(o=+i.closeTime,i.autoHide===n.ALLOWAUTOHIDE&&!isNaN(o)&&i.closeTime>=0)t=setTimeout(function(){exports.inviteWindowSwitch("off")},1e3*o)}else if("hide"===e)if(i.reInvite===n.ALLOWREINVITE&&"number"==typeof i.inviteInterval&&i.inviteInterval>=0)o=i.inviteInterval,t=setTimeout(function(){exports.inviteWindowSwitch("on")},1e3*o)}var t,exports={},i=function(e){if("string"!=typeof e)return"";var t=document.createElement("a");return t.href=e,t.hostname};return exports.delayToShow=function(e,t,i){var n=i.getServer("configBox").inviteBox.stayTime;if("number"!=typeof n||0>n)n=0;else n=1e3*n;e.set(t.INVITECOOKIENAME,location.hostname,{path:"/"}),e.set(t.INVITESTARTPAGECOOKIE,location.href,{path:"/"}),setTimeout(function(){exports.inviteWindowSwitch("on")},n)},exports.inviteWindowGuard=function(e,t,n){var o=t.getServer("configBox").inviteBox;if(o.autoInvite===e.AUTOINVITEON){if(+o.startPage===e.ALLPAGE)exports.delayToShow();if(+o.startPage===e.ONLYSTARTPAGE){var a=n.get(e.INVITESTARTPAGECOOKIE);if(!a)exports.delayToShow();else if(a===location.href)exports.delayToShow();else if(document.referrer){var r=i(document.referrer);if(r!==location.hostname)exports.delayToShow()}else{var s=n.get(e.INVITECOOKIENAME);if(s){if(s!==location.hostname)exports.delayToShow()}else exports.delayToShow()}}}},exports.inviteWindowSwitch=function(t,i,n,o){var a=n.getServer("configBox").inviteBox;if("on"===o){if(t.show([i.WRAPID]),a.autoHide===i.ALLOWAUTOHIDE)e("show",a,i)}else if("off"===o)if(t.hide([i.WRAPID]),a.reInvite===i.ALLOWREINVITE)e("hide",a,i)},exports.showInvite=function(e,t,i){i.timeKey=setTimeout(function(){t.show("nb_invite_wrap")},e.SHOWINTERVAL)},exports.process=function(){},exports.renderHTML=function(e,t,i,n,o){var a=t.getWrap(),r=i.getInviteStyle(),s=o.template(n,r);e.appendHTML(s,a)},exports.init=function(e){exports.renderHTML(),e.init()},exports}),define("embed/invite/mobile/inviteMobileHandler",["require"],function(require){var exports={};return exports.acceptInvite=function(e,t){e.accept(1),t.inviteWindowSwitch("off")},exports.refuseInvite=function(e,t,i){if(2===e.fromType)t.refuse();i.inviteWindowSwitch("off")},exports.getClickEle=function(e){return e.PREFIXID+"ok"},exports.process=function(e){e.inviteWindowGuard()},exports}),define("embed/invite/mobile/inviteMobile.tpl",[],function(){return'<!-- target: invitebox --><% if (data.isCustomerStyle) { %><% if (data.position === \'middle\') { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> nb-invite-custom mobile-invite-<%position%>" id="nb_invite_wrap" style="min-height:<%height%>%;width:<%width%>%;display:none;background-image:url(<%customerStyle.backImg%>)"><% } else { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> nb-invite-custom mobile-invite-<%position%>" id="nb_invite_wrap" style="min-height:<%height%>%;display:none;background-image:url(<%customerStyle.backImg%>)"><% } %><% } else { %><% if (data.position === \'middle\') { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> mobile-invite-<%position%>" id="nb_invite_wrap" style="min-height:<%height%>%;width:<%width%>%;display:none;"><% } else { %><ins class="nb-invite-wrap-base nb-invite-wrap-<%skinIndex%> mobile-invite-<%position%>" id="nb_invite_wrap" style="min-height:<%height%>%;display:none;"><% } %><% } %><ins class="nb-invite-tool-base nb-invite-tool" id="nb_invite_tool">×</ins><ins class="nb-invite-body-base nb-invite-body"><ins class="nb-invite-welcom <%isShowText%>"><%welcome%></ins><ins class="nb-invite-btns"><% if (data.isCustomerStyle) { %><ins class="nb-invite-ok" id="nb_invite_ok" style="background-color:<%customerStyle.acceptBgColor%>;color:<%customerStyle.acceptFontColor%>">\u73b0\u5728\u54a8\u8be2</ins><% } else { %><ins class="nb-invite-ok" id="nb_invite_ok">\u73b0\u5728\u54a8\u8be2</ins><% } %><ins class="nb-invite-no" id="nb_invite_cancel">\u7a0d\u540e\u518d\u8bf4</ins></ins></ins></ins><!-- end -->'; }),define("embed/invite/mobile/inviteMobileData",["require"],function(require){var exports={};return exports.dataProcess=function(e,t,i){var n=t.extend({},i);if(i.isCustomerStyle)n.inviteClass="nb-invite-custom";else n.inviteClass=e.SKINPRE+i.skinIndex;return n.isShowText=["hide","show"][+i.isShowText],n},exports}),define("embed/invite/mobile/inviteMobileConsts",[],function(){return{SHOWINTERVAL:2e3,AUTOINVITEON:1,AUTOINVITEOFF:0,ONLYSTARTPAGE:0,ALLPAGE:1,ALLOWREINVITE:1,DENYREINVITE:0,ALLOWAUTOHIDE:1,DENYAUTOHIDE:0,INVITECOOKIENAME:"nb-referrer-hostname",INVITESTARTPAGECOOKIE:"nb-start-page-url",PREFIXID:"nb_invite_",WRAPID:"nb_invite_wrap",SKINPRE:"nb-invite-wrap-"}}),define("embed/invite/inviteMConfig",["require","./inviteMain","./inviteData","./inviteHandler","./mobile/inviteMMain","./mobile/inviteMobileHandler","./mobile/inviteMobile.tpl","./mobile/inviteMobileData","./mobile/inviteMobileConsts"],function(require){return{"package":"minvite",resource:{main:require("./inviteMain"),data:require("./inviteData"),handler:require("./inviteHandler"),mmain:require("./mobile/inviteMMain"),mhandler:require("./mobile/inviteMobileHandler"),tpl:require("./mobile/inviteMobile.tpl"),mdata:require("./mobile/inviteMobileData"),consts:require("./mobile/inviteMobileConsts")},injection:[{id:"minvite.main",method:{init:["minvite.handler"],renderHtml:["mbase.dom","common.view","minvite.data","common.util","minvite.tpl","minvite.mmain"]}},{id:"minvite.data",method:{getInviteStyle:["data.config","minvite.mdata"]}},{id:"minvite.handler",method:{bindEvent:["mbase.events","minvite.consts","minvite.mhandler"]}},{id:"minvite.mmain",method:{init:["minvite.mhandler"],renderHTML:["mbase.dom","common.view","minvite.mdata","minvite.tpl","common.util"],showInvite:["minvite.mdata","mbase.dom"],inviteWindowGuard:["minvite.consts","data.config","common.cookie"],delayToShow:["common.cookie","minvite.consts","data.config"],inviteWindowSwitch:["mbase.dom","minvite.consts","data.config"]}},{id:"minvite.mdata",method:{dataProcess:["minvite.consts","mbase.lib"]}},{id:"minvite.mhandler",method:{bindEvent:["mbase.events","minvite.mhandler","minvite.consts","minvite.mmain"],acceptInvite:["mchat.chat","minvite.mmain"],refuseInvite:["core.config","mchat.chat","minvite.mmain"],getClickEle:["minvite.consts"],process:["minvite.mmain"]}}],aspect:[{id:"minvite.main",pointCut:["micon.main.init, , init"]}]}}),define("embed/icon/iconMain",["require"],function(require){var exports={};return exports.renderHtml=function(e,t,i,n,o){var a=e.getIconTplData(),r=i.template(t,a);n.appendHTML(r,o.getWrap())},exports.init=function(e,t){var i=t.getServer("configBox").seekIcon;if(0!==+i.width)exports.renderHtml(),e.init()},exports}),define("embed/icon/iconHandler",["require"],function(require){var exports={};return exports.handleAccept=function(e,t){e.clickIcon(t)},exports.bindEvent=function(e,t){e.domOn("nb_icon_wrap","click",exports.handleAccept,!1),t.bindEvent()},exports.init=function(){exports.bindEvent()},exports}),define("embed/icon/iconData",["require"],function(require){var exports={};return exports.getIconTplData=function(e,t){var i=e.getServer("configBox").seekIcon,n=t.dataProcess(i);if(i.isCustomerStyle)n.backImg="background-image: url("+n.customerStyle.backImg+");";return n},exports}),define("embed/icon/mobile/iconMobileData",["require"],function(require){function e(e,t,i,n,o){var a={};switch(e){case"flag":var r=0;if("right-center"===t||"left-center"===t)r=n-Math.ceil(n/2);else r=n;if(o.isBDBox)r-=1;a.flagPosition="margin-top:"+r+"px",a.borderLeftWidth=Math.ceil(i/2)+"vw",a.borderRightWidth=i-parseInt(a.borderLeftWidth,10)+"vw";break;default:a={}}return a}var exports={};return exports.dataProcess=function(t,i,n){var o=t.extend({},n),a=["","circle","flag","sector","circle","flag"][n.skinIndex];return o.shape=e(a,n.position,n.width,n.height,i),o},exports}),define("embed/icon/mobile/iconMobile.tpl",[],function(){return'<!-- target: iconicon --><ins id="nb_icon_wrap" class="nb-icon-wrap nb-icon-<%position%> nb-icon-wrap-<%skinIndex%>" style="height:<%height%>%;width:<%width%>%;"><% if (data.isCustomerStyle == 1) { %><ins class="nb-icon-wrap-base nb-icon-customer" style="background-image:url(<%customerStyle.backImg%>);"></ins><% } else { %><ins class="nb-icon-wrap-base nb-icon-wrap-<%skinIndex%>-<%position%>"></ins><% if (data.skinIndex == 2 || data.skinIndex == 5) { %><ins style="border-left-width: <%shape.borderLeftWidth%>;border-right-width: <%shape.borderRightWidth%>;" class="nb-icon-flag nb-icon-flag-<%skinIndex%>"></ins><% } %><% } %></ins>'}),define("embed/icon/mobile/iconMobileHandler",["require"],function(require){var exports={};return exports.bindEvent=function(e,t){},exports.clickIcon=function(e,t){e.accept(0),t.hide(["nb_invite_wrap"])},exports}),define("embed/icon/mobile/iconMobileConsts",[],function(){return{PREFIXID:"nb_icon_"}}),define("embed/icon/iconMConfig",["require","./iconMain","./iconHandler","./iconData","./mobile/iconMobileData","./mobile/iconMobile.tpl","./mobile/iconMobileHandler","./mobile/iconMobileConsts"],function(require){return{"package":"micon",resource:{main:require("./iconMain"),handler:require("./iconHandler"),data:require("./iconData"),mdata:require("./mobile/iconMobileData"),tpl:require("./mobile/iconMobile.tpl"),phandler:require("./mobile/iconMobileHandler"),consts:require("./mobile/iconMobileConsts")},injection:[{id:"micon.phandler",method:{bindEvent:["mbase.events","micon.consts","micon.phandler"],clickIcon:["mchat.chat","mbase.dom"],handleMouse:["micon.consts","mbase.events"]}},{id:"micon.mdata",method:{dataProcess:["mbase.lib","mbase.brower"]}},{id:"micon.main",method:{init:["micon.handler","data.config"]}},{id:"micon.main",method:{renderHtml:["micon.data","micon.tpl","common.util","mbase.dom","common.view"]}},{id:"micon.data",method:{getIconTplData:["data.config","micon.mdata"]}},{id:"micon.handler",method:{bindEvent:["mbase.events","micon.phandler"],handleAccept:["micon.phandler"]}}]}}),define("base/pc/lib",["require"],function(require){function e(e,t){var i="",n=0>e,o=Math.abs(e)+"";if(o.length<t)i=new Array(t-o.length+1).join("0");return(n?"-":"")+i+o}var exports={},t=/\{\s*\[(?:native code|function)\]\s*\}/i;return exports.isType=function(e,t){return{}.toString.call(e).indexOf("[object "+t)>=0},exports.isNative=function(e){return!(!e||!t.test(e))},exports.instanceOf=function(e,t){return e&&e.hasOwnProperty&&e instanceof t},exports.extend=function(e,t){for(var i in t)if(t.hasOwnProperty(i)&&"_belong"!==i)e[i]=t[i];return e},exports.getBid=function(){var e,t=(+new Date).toString(),i=Math.floor(1e5*Math.random()).toString(),n=5-i.length;if(n>0)for(e=0;n>e;e++)i+="0";return t+i},exports.uuid=function(){for(var e=[],t="0123456789abcdef",i=0;36>i;i++)e[i]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n},exports.parseTime=function(t,i){function n(e,t){i=i.replace(e,t)}if("string"!=typeof i)return t.toString();var o=t.getFullYear(),a=t.getMonth()+1,r=t.getDate(),s=t.getHours(),l=t.getMinutes(),h=t.getSeconds();return n(/yyyy/g,e(o,4)),n(/yy/g,e(parseInt(o.toString().slice(2),10),2)),n(/MM/g,e(a,2)),n(/M/g,a),n(/dd/g,e(r,2)),n(/d/g,r),n(/HH/g,e(s,2)),n(/H/g,s),n(/hh/g,e(s%12,2)),n(/h/g,s%12),n(/mm/g,e(l,2)),n(/m/g,l),n(/ss/g,e(h,2)),n(/s/g,h),i},exports.trim=function(e){var t=new RegExp("(^[\\s\\t\\xa0\\u3000]+)|([\\u3000\\xa0\\s\\t]+$)","g");return String(e).replace(t,"")},exports.transferDate=function(e){if(e=+e,isNaN(e))return e;var t=+new Date(e),i=["\u4eca\u5929","\u6628\u5929"],n=864e5,o=new Date,a=parseInt((+o-6e4*o.getTimezoneOffset())/n,10),r=a-parseInt((t-6e4*o.getTimezoneOffset())/n,10);if(r=Math.abs(r),r<i.length)return i[r];else return exports.parseTime(new Date(e),"yyyy-MM-dd")},exports}),define("embed/log/main",["require","../../base/pc/lib"],function(require){function e(e){return!s[e]&&(s[e]="uuid_"+a.uuid()),s[e]}function t(){return!s.tabid&&(s.tabid="tabid_"+(new Date).getTime()),s.tabid}function i(e){var t=(new Date).getTime()-r[e];return t}function n(e,t){r[e]=t||+new Date}function o(e){var t=1,i=e.match(/(iPad).*OS\s([\d_]+)/),n=!i&&e.match(/(iPhone\sOS)\s([\d_]+)/),o=e.match(/(Android);?[\s\/]+([\d.]+)?/);if(i||n)t=3;else if(o)t=2;return t}var a=require("../../base/pc/lib"),exports={},r={},s={pushTotalMsg:0,pushFailMsg:0,pickMsg:0,pushMsg:0,ifLoopStart:!1},l={};return exports.init=function(e){var t=e.getServer(),i=t.siteObj;r.eid=i.eid,r.siteid=i.siteId,r.platform=i.platform,r.bid=i.bid,r.logRoot=e.staticDomain,r.startTime=t.startTime},exports.addLightMsg=function(e){var t=e.role?"sub":"custom";if("sub"===t)s.pickMsg++;else s.pushMsg++,s.pushTotalMsg++},exports.sendFailMsg=function(){s.pushFailMsg++},exports.logQueue=function(){exports.sendLog(t(),{uuid:e("openUUID"),cncttype:"queue",brgeyemid:"m2007",winType:"webimLight",cost:l.render+i("m2013"),queueCost:i("m2013")})},exports.logConnect=function(){if(exports.sendLog(t(),{uuid:e("openUUID"),cncttype:"connected",brgeyemid:"m2007",winType:"webimLight",cost:l.render+i("m2013"),transferCost:i("m2013")}),!s.ifLoopStart)exports.logPickMsg(),exports.logPushMsg(),s.ifLoopStart=!0},exports.logTransferFail=function(){exports.sendLog(t(),{uuid:e("openUUID"),cncttype:"failed",brgeyemid:"m2007",winType:"webimLight",cost:l.render+i("m2013"),transferCost:i("m2013")})},exports.logOpenWebim=function(){exports.sendLog(t(),{cncttype:"openWebim",uuid:e("openUUID"),brgeyemid:"m2006"})},exports.logClickSeek=function(e){var i={brgeyemid:"m2005"};e&&(i.type=e),exports.sendLog(t(),i)},exports.logPickMsg=function(){var e=function(){var e=s.pickMsg;if(s.pickMsg=0,e>0)exports.sendLog(t(),{num:e,brgeyemid:"m2004"});setTimeout(arguments.callee,5e3)};setTimeout(e,5e3)},exports.logPushMsg=function(){var e=function(){var e=s.pushMsg;if(s.pushMsg=0,e>0)exports.sendLog(t(),{num:e,brgeyemid:"m2003"});setTimeout(arguments.callee,5e3)};setTimeout(e,5e3)},exports.logEndNb=function(){exports.sendLog(t(),{uuid:e("nbUUID"),brgeyemid:"m2002"})},exports.logStartNb=function(){exports.sendLog(t(),{uuid:e("nbUUID"),brgeyemid:"m2001"})},exports.logRenderStart=function(){n("m2008",r.startTime),exports.sendLog(t(),{uuid:e("renderUUID"),brgeyemid:"m2008"})},exports.logRenderEnd=function(){l.render=i("m2008"),exports.sendLog(t(),{cncttype:"renderFinish",uuid:e("renderUUID"),brgeyemid:"m2009",cost:l.render})},exports.logEnterStart=function(){n("m2010"),exports.sendLog(t(),{cncttype:"startSite",uuid:e("enterUUID"),brgeyemid:"m2010"})},exports.logEnterEnd=function(){exports.sendLog(t(),{cncttype:"finishSite",uuid:e("enterUUID"),brgeyemid:"m2011",cost:i("m2008"),siteCost:i("m2010")})},exports.logStartTransfer=function(){n("m2013")},exports.leaveSite=function(){exports.sendLog(t(),{uuid:e("enterUUID"),brgeyemid:"m2012",totalMsgCount:s.pushTotalMsg,failMsgCount:s.pushFailMsg}),exports.sendLog(t(),{uuid:e("msgFailRate"),brgeyemid:"m2014",totalMsgCount:s.pushTotalMsg,failMsgCount:s.pushFailMsg})},exports.sendLog=function(e,t,i,n,a){var s=a||{};s.t=(new Date).getTime(),s.ip="",s.dtype=o(navigator.userAgent),s.ucid=i.eid||r.eid,s.uid=t.get("to")||i.tid||"",s.siteid=i.siteid||r.siteid,s.tabid=n,s.bid=i.bid||r.bid,s.sessionid=t.get("sid")||i.sid||"",s.originType=0,e.send(r.logRoot,s)},exports}),define("embed/log/mobileConfig",["require","./main"],function(require){return{"package":"log",resource:{main:require("./main")},injection:[{id:"log.main",method:{init:["data.config"],sendLog:["core.log","core.chat","core.config"]}}],aspect:[{id:"log.main",pointCut:["micon.main.init, logRenderStart, ","icon.handle.acceptClick, ,logClickSeek","invite.operation.clickInvite, ,logClickSeek","minvite.main.init, , logRenderEnd","mchat.chat.builtComunicate, logEnterStart, ","mchat.chat.enterSuccess, ,logEnterEnd","mchat.leave.pageLeave, , leaveSite","micon.phandler.clickIcon, ,logClickSeek"]}]}}),define("embed/entry/mobile/mobileConfig",["require","im-core/bullConfig","im-lib/config","../../../base/baseMobileConfig","../../../common/mobileConfig","../../data/bullConfig","../../embedChat/mConfig","../../invite/inviteMConfig","../../icon/iconMConfig","../../log/mobileConfig"],function(require){return{"package":"membed",importConfig:[require("im-core/bullConfig"),require("im-lib/config"),require("../../../base/baseMobileConfig"),require("../../../common/mobileConfig"),require("../../data/bullConfig"),require("../../embedChat/mConfig"),require("../../invite/inviteMConfig"),require("../../icon/iconMConfig"),require("../../log/mobileConfig")]}}),define("embed/entry/mobile/mobileHack",["require","common/view","base/mobile/dom"],function(require){var e=require("common/view"),t=require("base/mobile/dom"),exports={};return exports.init=function(){this.regex={initScale:/initial\-scale/},this.check()},exports.check=function(){var i=this,n=e.getWrap(),o=document.querySelectorAll('meta[name="viewport"]');o=[].slice.call(o);var a=!1;if(o.some(function(e){var t=e.getAttribute("content");if(t.match(i.regex.initScale))return a=!0,!0;else return void 0}),!a)t.setStyle(n,"mobile-no-scale")},exports}),define("base/pc/brower",[],function(){var e,t=document,i=new RegExp("msie (\\d+\\.\\d+)|trident","i");return{ie:function(){return i.test(navigator.userAgent)?t.documentMode||+RegExp.$1:e}(),isBDBox:/ baiduboxapp\//i.test(navigator.userAgent),opera:/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(navigator.userAgent)?+(RegExp.$6||RegExp.$2):void 0,isStrict:function(){return"CSS1Compat"===t.compatMode},isMobile:function(){var e=navigator.userAgent;return!!e.match(/.*Mobile.*/)||"ontouchstart"in window}()}}),define("cl",["require","./base/pc/brower"],function(require){var exports={},e=require("./base/pc/brower");return exports.load=function(t,i,n,o){var a=document.createElement("link");if(a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href",i.toUrl(t)),("object"==typeof a.onload||"object"==typeof a.onreadystatechange)&&!e.isBDBox){var r=!1;a.onload=function(){a.onreadystatechange=null,a.onload=null,n(!0),r=!0},a.onreadystatechange=function(){if(/^loaded|complete$/.test(this.readyState))this.onreadystatechange=null,a.onload=null,n(!0),r=!0},setTimeout(function(){if(!r)n(!0)},3e3)}else n(!0);var s=document.getElementsByTagName("head")[0]||document.body;s.appendChild(a)},exports}),define("lib/css",["cl"],function(e){return e}),define("common/css",["cl"],function(e){return e}),define("embed/entry/mobile/main",["require","bull","./mobileConfig","./mobileHack","cl!../../css/mobile/main.css","../../../base/mobile/event"],function(require){var exports={},e=require("bull"),t=require("./mobileConfig"),i=require("./mobileHack");return exports.init=function(){require("cl!../../css/mobile/main.css"),e.init(t),e.get("log.main").init(),this.bindEvent(),e.get("micon.main").init(),this.handle()},exports.bindEvent=function(){function e(e){e.stopPropagation()}var t=require("../../../base/mobile/event"),i="newBridge";t.domOn(i,"touchsatart",e),t.domOn(i,"touchmove",e),t.domOn(i,"touchend",e)},exports.handle=function(){i.init()},exports}),require(["embed/entry/mobile/main"],function(e){e.init()})}(this);
